{"code":"(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[18],{\"/yFf\":function(e,t,r){\"use strict\";var n=r(\"oHnp\");function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e[\"content-type\"]||\"\";this.type=n.type(t);var r=n.params(t);for(var i in r)this[i]=r[i];this.links={};try{e.link&&(this.links=n.parseLinks(e.link))}catch(s){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},\"24Ii\":function(e,t,r){var n;\"undefined\"!==typeof window?n=window:\"undefined\"!==typeof self?n=self:(console.warn(\"Using browser-only version of superagent in non-browser environment\"),n=this);var i=r(\"cpc2\"),s=r(\"kMlx\"),o=r(\"8zgK\"),a=r(\"/yFf\"),c=r(\"nZbv\");function u(){}var l=t=e.exports=function(e,r){return\"function\"==typeof r?new t.Request(\"GET\",e).end(r):1==arguments.length?new t.Request(\"GET\",e):new t.Request(e,r)};t.Request=w,l.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&\"file:\"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}try{return new ActiveXObject(\"Msxml2.XMLHTTP.6.0\")}catch(e){}try{return new ActiveXObject(\"Msxml2.XMLHTTP.3.0\")}catch(e){}try{return new ActiveXObject(\"Msxml2.XMLHTTP\")}catch(e){}throw Error(\"Browser-only version of superagent could not find XHR\")};var h=\"\".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\\s*|\\s*$)/g,\"\")};function f(e){if(!o(e))return e;var t=[];for(var r in e)d(t,r,e[r]);return t.join(\"&\")}function d(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach((function(r){d(e,t,r)}));else if(o(r))for(var n in r)d(e,t+\"[\"+n+\"]\",r[n]);else e.push(encodeURIComponent(t)+\"=\"+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function p(e){for(var t,r,n={},i=e.split(\"&\"),s=0,o=i.length;s<o;++s)-1==(r=(t=i[s]).indexOf(\"=\"))?n[decodeURIComponent(t)]=\"\":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function g(e){return/[\\/+]json($|[^-\\w])/.test(e)}function y(e){this.req=e,this.xhr=this.req.xhr,this.text=\"HEAD\"!=this.req.method&&(\"\"===this.xhr.responseType||\"text\"===this.xhr.responseType)||\"undefined\"===typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,r,n,i,s=e.split(/\\r?\\n/),o={},a=0,c=s.length;a<c;++a)-1!==(t=(r=s[a]).indexOf(\":\"))&&(n=r.slice(0,t).toLowerCase(),i=h(r.slice(t+1)),o[n]=i);return o}(this.xhr.getAllResponseHeaders()),this.header[\"content-type\"]=this.xhr.getResponseHeader(\"content-type\"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body=\"HEAD\"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function w(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on(\"end\",(function(){var e,t=null,n=null;try{n=new y(r)}catch(i){return(t=new Error(\"Parser is unable to parse the response\")).parse=!0,t.original=i,r.xhr?(t.rawResponse=\"undefined\"==typeof r.xhr.responseType?r.xhr.responseText:r.xhr.response,t.status=r.xhr.status?r.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),r.callback(t)}r.emit(\"response\",n);try{r._isResponseOK(n)||(e=new Error(n.statusText||\"Unsuccessful HTTP response\"))}catch(s){e=s}e?(e.original=t,e.response=n,e.status=n.status,r.callback(e,n)):r.callback(null,n)}))}function E(e,t,r){var n=l(\"DELETE\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}l.serializeObject=f,l.parseString=p,l.types={html:\"text/html\",json:\"application/json\",xml:\"text/xml\",urlencoded:\"application/x-www-form-urlencoded\",form:\"application/x-www-form-urlencoded\",\"form-data\":\"application/x-www-form-urlencoded\"},l.serialize={\"application/x-www-form-urlencoded\":f,\"application/json\":JSON.stringify},l.parse={\"application/x-www-form-urlencoded\":p,\"application/json\":JSON.parse},a(y.prototype),y.prototype._parseBody=function(e){var t=l.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&g(this.type)&&(t=l.parse[\"application/json\"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},y.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n=\"cannot \"+t+\" \"+r+\" (\"+this.status+\")\",i=new Error(n);return i.status=this.status,i.method=t,i.url=r,i},l.Response=y,i(w.prototype),s(w.prototype),w.prototype.type=function(e){return this.set(\"Content-Type\",l.types[e]||e),this},w.prototype.accept=function(e){return this.set(\"Accept\",l.types[e]||e),this},w.prototype.auth=function(e,t,r){1===arguments.length&&(t=\"\"),\"object\"===typeof t&&null!==t&&(r=t,t=\"\"),r||(r={type:\"function\"===typeof btoa?\"basic\":\"auto\"});var n=function(e){if(\"function\"===typeof btoa)return btoa(e);throw new Error(\"Cannot use basic auth, btoa is not a function\")};return this._auth(e,t,r,n)},w.prototype.query=function(e){return\"string\"!=typeof e&&(e=f(e)),e&&this._query.push(e),this},w.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error(\"superagent can't mix .send() and .attach()\");this._getFormData().append(e,t,r||t.name)}return this},w.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},w.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit(\"error\",e)),r(e,t)},w.prototype.crossDomainError=function(){var e=new Error(\"Request has been terminated\\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.\");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},w.prototype.buffer=w.prototype.ca=w.prototype.agent=function(){return console.warn(\"This is not supported in browser version of superagent\"),this},w.prototype.pipe=w.prototype.write=function(){throw Error(\"Streaming is not supported in browser version of superagent\")},w.prototype._isHost=function(e){return e&&\"object\"===typeof e&&!Array.isArray(e)&&\"[object Object]\"!==Object.prototype.toString.call(e)},w.prototype.end=function(e){return this._endCalled&&console.warn(\"Warning: .end() was called twice. This is not supported in superagent\"),this._endCalled=!0,this._callback=e||u,this._finalizeQueryString(),this._end()},w.prototype._end=function(){var e=this,t=this.xhr=l.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(i){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit(\"end\")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit(\"progress\",r)};if(this.hasListeners(\"progress\"))try{t.onprogress=n.bind(null,\"download\"),t.upload&&(t.upload.onprogress=n.bind(null,\"upload\"))}catch(a){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(c){return this.callback(c)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&\"GET\"!=this.method&&\"HEAD\"!=this.method&&\"string\"!=typeof r&&!this._isHost(r)){var i=this._header[\"content-type\"],s=this._serializer||l.serialize[i?i.split(\";\")[0]:\"\"];!s&&g(i)&&(s=l.serialize[\"application/json\"]),s&&(r=s(r))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&t.setRequestHeader(o,this.header[o]);return this._responseType&&(t.responseType=this._responseType),this.emit(\"request\",this),t.send(\"undefined\"!==typeof r?r:null),this},l.agent=function(){return new c},[\"GET\",\"POST\",\"OPTIONS\",\"PATCH\",\"PUT\",\"DELETE\"].forEach((function(e){c.prototype[e.toLowerCase()]=function(t,r){var n=new l.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}})),c.prototype.del=c.prototype.delete,l.get=function(e,t,r){var n=l(\"GET\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.head=function(e,t,r){var n=l(\"HEAD\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.options=function(e,t,r){var n=l(\"OPTIONS\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.del=E,l.delete=E,l.patch=function(e,t,r){var n=l(\"PATCH\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.post=function(e,t,r){var n=l(\"POST\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.put=function(e,t,r){var n=l(\"PUT\",e);return\"function\"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},\"2k3W\":function(e,t,r){\"use strict\";r.r(t),r.d(t,\"bits\",(function(){return i})),r.d(t,\"buffer\",(function(){return E})),r.d(t,\"byte\",(function(){return _})),r.d(t,\"integer\",(function(){return v})),r.d(t,\"nibble\",(function(){return m})),r.d(t,\"string\",(function(){return b}));for(var n=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=1^e[r];return t},i={and:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=e[n]&t[n];return r},nand:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=e[n]&t[n]^1;return r},nor:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=1^(e[n]|t[n]);return r},not:n,or:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=e[n]|t[n];return r},reduceAnd:function(e){if(e.length<2)throw new RangeError(\"Not enough bits.\");for(var t=e[0],r=1;r<e.length;r++)t&=e[r];return t},reduceNand:function(e){if(e.length<2)throw new RangeError(\"Not enough bits.\");for(var t=e[0],r=1;r<e.length;r++)t=t&e[r]^1;return t},reduceNor:function(e){if(e.length<2)throw new RangeError(\"Not enough bits.\");for(var t=e[0],r=1;r<e.length;r++)t=1^(t|e[r]);return t},reduceOr:function(e){if(e.length<2)throw new RangeError(\"Not enough bits.\");for(var t=e[0],r=1;r<e.length;r++)t|=e[r];return t},reduceXnor:function(e){if(e.length<2)throw new RangeError(\"Not enough bits.\");for(var t=e[0],r=1;r<e.length;r++)t^=1^e[r];return t},reduceXor:function(e){if(e.length<2)throw new RangeError(\"Not enough bits.\");for(var t=e[0],r=1;r<e.length;r++)t^=e[r];return t},toBoolean:function(e){for(var t=[],r=0;r<e.length;r++)t[r]=1===e[r];return t},toString:function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=\" \"),!t)return e.join(\"\");for(var n=\"\",i=0;i<e.length;i++)n+=\"\"+e[i],i%t===t-1&&i!==e.length-1&&(n+=r);return n},xnor:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=e[n]^t[n]^1;return r},xor:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}},s=r(\"XUzR\"),o=r(\"GCxg\"),a=r(\"G1u+\"),c=function(e){if(e>255||e<0||~~e!==e)throw new RangeError(\"invalid byte\");for(var t=[0,0,0,0,0,0,0,0],r=0;r<8;r++)t[7-r]=e>>r&1;return t},u=function(e,t,r){void 0===t&&(t=0),r||(r=8*e.length-t);var n=Math.floor(t/8),i=Math.floor(r/8)+2,s=[];s.length=8*i;for(var o=0;o<i;o++){if(void 0!==e[n+o]){var a=c(e[n+o]);s[8*o]=a[0],s[8*o+1]=a[1],s[8*o+2]=a[2],s[8*o+3]=a[3],s[8*o+4]=a[4],s[8*o+5]=a[5],s[8*o+6]=a[6],s[8*o+7]=a[7]}}var u=t%8;return s.slice(u,u+r)},l=r(\"nMdu\"),h=r(\"ILq/\"),f=r(\"f7RY\"),d=r(\"YnKP\"),p=[],g=0;g<32;g++)p[g]=Math.pow(2,g);var y=r(\"vGFC\"),w=r(\"5tNv\"),E={and:s.a,create:o.a,modify:function(e,t,r){void 0===r&&(r=0);for(var n=Math.floor(r/8),i=Math.ceil((r+t.length)/8),s=e.slice(n,i),o=u(s),c=r%8,l=0;l<t.length;l++)o[c++]=t[l];for(var h=i-n,f=0;f<h;f++)s[f]=Object(a.a)(o.slice(8*f,8*(f+1)))},nand:l.a,nor:h.a,not:f.a,or:d.a,read:u,readInt:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=8);var i=u(e,t,r);if(0===i[0]){for(var s=0,o=0;o<r;o++)i[o]&&(s+=p[r-o-1]);return s}s=-1;var a=n(i);for(o=0;o<r;o++)a[o]&&(s-=p[r-o-1]);return s},readUInt:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=8);for(var n=u(e,t,r),i=0,s=0;s<r;s++)i+=n[s]*p[r-s-1];return i},xnor:y.a,xor:w.a},_={read:c,write:a.a},v={getBit:function(e,t){return e>>t&1},setBit:function(e,t,r){return 1===r?e|1<<t:e&~(1<<t)},toggleBit:function(e,t){return e^1<<t}},m={read:function(e){if(e<16&&e>=0&&Math.floor(e)===e){for(var t=[0,0,0,0],r=0;r<4;r++)t[3-r]=e>>r&1;return t}throw new RangeError(\"invalid array length\")},write:function(e){if(!Array.isArray(e)||4!==e.length)throw new RangeError(\"invalid array length\");for(var t=0,r=0;r<4;r++)e[3-r]&&(t|=1<<r);return t}},b={toBits:function(e){for(var t=[],r=0;r<e.length;r++)\"1\"===e[r]?t.push(1):\"0\"===e[r]&&t.push(0);return t}},S={bits:i,buffer:E,byte:_,integer:v,nibble:m,string:b};t.default=S},\"4Mn8\":function(e,t,r){const n=r(\"pzNo\");e.exports={Client:n}},\"5tNv\":function(e,t,r){\"use strict\";(function(e){t.a=function(t,r,n){void 0===n&&(n=!1);for(var i=n?r.length:t.length,s=e.alloc(i),o=0;o<i;o++){var a=n?o%t.length:o;s[o]=t[a]^r[o]}return s}}).call(this,r(\"HDXh\").Buffer)},\"6WMX\":function(e,t,r){const n=r(\"B3Rj\"),i=r(\"b3gk\"),s=r(\"HDXh\").Buffer,o=r(\"L21C\"),a=s.from(\"01\",\"hex\"),{HARDENED_OFFSET:c}=r(\"L21C\"),u=[44+c,c,c,1,0],l={0:0,HASH160:169,DUP:118,EQUAL:135,EQUALVERIFY:136,CHECKSIG:172},h={LEGACY:0,SEGWIT:5,TESTNET:111,SEGWIT_TESTNET:196};t.addressVersion=h;const f={P2PKH:1,P2SH:2,P2SH_P2WPKH:3};function d(e,t){return s.concat([e,t])}function p(e){const t=s.alloc(4);return t.writeUInt32LE(e),t}function g(e){let t;return e<253?(t=s.alloc(1),t.writeUInt8(e)):e<=65535?(t=s.alloc(3),t.writeUInt8(253,0),t.writeUInt16LE(e,1)):e<4294967295?(t=s.alloc(5),t.writeUInt8(254,0),t.writeUInt32LE(e,1)):(t=s.alloc(9),t.writeUInt8(255,0),t.writeUInt32LE(e>>>0,1),t.writeUInt32LE(e/4294967296|0,5)),t}function y(e,t,r){\"number\"===typeof e&&(e=e.toString(16));const n=s.alloc(8),i=e.length%2===0?e.toString(16):`0${e.toString(16)}`;return s.from(i,\"hex\").reverse().copy(n,0),n.copy(t,r),n}t.scriptTypes=f,t.buildBitcoinTxRequest=function(e){try{const{prevOuts:t,recipient:r,value:a,changePath:c=u,fee:l,isSegwit:d,changeVersion:p=\"SEGWIT\"}=e;if(5!==c.length)throw new Error(\"Please provide a full change path.\");const g=s.alloc(59+69*t.length);let w=0;if(void 0===h[p])throw new Error(\"Invalid change version specified.\");g.writeUInt8(h[p]),w++,g.writeUInt32LE(c.length,w),w+=4;for(let e=0;e<c.length;e++)g.writeUInt32LE(c[e],w),w+=4;g.writeUInt32LE(l,w),w+=4;const E=n.decode(r)[0],_=i.decode(r).slice(1);g.writeUInt8(E,w),w++,_.copy(g,w),w+=_.length,y(a,g,w),w+=8,g.writeUInt8(t.length,w),w++;let v=0;const m=!0===d?f.P2SH_P2WPKH:f.P2PKH;return t.forEach(e=>{if(!e.signerPath||5!==e.signerPath.length)throw new Error(\"Full recipient path not specified \");g.writeUInt32LE(e.signerPath.length,w),w+=4;for(let t=0;t<e.signerPath.length;t++)g.writeUInt32LE(e.signerPath[t],w),w+=4;g.writeUInt32LE(e.index,w),w+=4,y(e.value,g,w),w+=8,v+=e.value,g.writeUInt8(m,w),w++,s.isBuffer(e.txHash)||(e.txHash=s.from(e.txHash,\"hex\")),e.txHash.copy(g,w),w+=e.txHash.length}),{payload:g,schema:o.signingSchema.BTC_TRANSFER,origData:e,changeData:{changeVersion:p,value:v-(a+l)}}}catch(t){return{err:t}}},t.serializeTx=function(e){const{inputs:t,outputs:r,isSegwitSpend:o,lockTime:c=0,crypto:u}=e;let f=s.alloc(4),w=0;f.writeUInt32LE(2,w),w+=4,!0===o&&(f=d(f,s.from(\"00\",\"hex\")),f=d(f,s.from(\"01\",\"hex\")));const E=g(t.length);f=d(f,E),w+=E.length,t.forEach(e=>{f=d(f,e.hash.reverse()),w+=e.hash.length;const t=p(e.index);if(f=d(f,t),w+=t.length,!0===o){const t=function(e,t){const r=s.alloc(22),n=t.createHash(\"sha256\").update(e).digest(),i=t.createHash(\"rmd160\").update(n).digest();return r.writeUInt8(l[0]),r.writeUInt8(i.length,1),i.copy(r,2),r}(e.pubkey,u),r=g(t.length),n=s.concat([r,t]),i=g(n.length);f=d(f,i),w+=i.length,f=d(f,n),w+=n.length}else{const t=function(e,t){const r=g((e=s.concat([e,a])).length),n=g(t.length),i=s.concat([r,e,n,t]),o=g(i.length);return s.concat([o,i])}(e.sig,e.pubkey);f=d(f,t),w+=t.length}const r=p(4294967295);f=d(f,r),w+=r.length});const _=g(r.length);if(f=d(f,_),w+=_.length,r.forEach(e=>{const t=function(e){const t=s.alloc(8);return y(e,t,0),t}(e.value);f=d(f,t),w+=t.length;const r=function(e){const t=n.decode(e)[0],r=i.decode(e).slice(1);return t===h.SEGWIT||t===h.SEGWIT_TESTNET?function(e){const t=s.alloc(3+e.length);let r=0;return t.writeUInt8(l.HASH160,r),r++,t.writeUInt8(e.length,r),r++,e.copy(t,r),r+=e.length,t.writeUInt8(l.EQUAL,r),r++,t}(r):function(e){const t=s.alloc(5+e.length);let r=0;return t.writeUInt8(l.DUP,r),r++,t.writeUInt8(l.HASH160,r),r++,t.writeUInt8(e.length,r),r++,e.copy(t,r),r+=e.length,t.writeUInt8(l.EQUALVERIFY,r),r++,t.writeUInt8(l.CHECKSIG,r),r++,t}(r)}(e.recipient),o=g(r.length);f=d(f,o),w+=o.length,f=d(f,r),w+=r.length}),!0===o){const e=[],r=[];for(let i=0;i<t.length;i++)e.push(t[i].sig),r.push(t[i].pubkey);const n=function(e,t){let r=s.alloc(0);const n=s.alloc(1);n.writeUInt8(2);for(let i=0;i<e.length;i++){const o=s.concat([e[i],a]),c=g(o.length),u=t[i],l=g(u.length);r=s.concat([r,n,c,o,l,u])}return r}(e,r);f=d(f,n),w+=n.length}return s.concat([f,p(c)]).toString(\"hex\")},t.getBitcoinAddress=function(e,t){return i.encode(s.concat([s.from([t]),e]))}},\"8zgK\":function(e,t,r){\"use strict\";e.exports=function(e){return null!==e&&\"object\"===typeof e}},B3Rj:function(e,t,r){var n=r(\"QqcV\");e.exports=n(\"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\")},BumV:function(e,t,r){\"use strict\";var n=r(\"B3Rj\"),i=r(\"hwdV\").Buffer;e.exports=function(e){function t(t){var r=t.slice(0,-4),n=t.slice(-4),i=e(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(t){var r=e(t);return n.encode(i.concat([t,r],t.length+4))},decode:function(e){var r=t(n.decode(e));if(!r)throw new Error(\"Invalid checksum\");return r},decodeUnsafe:function(e){var r=n.decodeUnsafe(e);if(r)return t(r)}}}},\"G1u+\":function(e,t,r){\"use strict\";t.a=function(e){if(!Array.isArray(e)||8!==e.length)throw new RangeError(\"invalid array length\");for(var t=0,r=0;r<8;r++)e[7-r]&&(t|=1<<r);return t}},GCxg:function(e,t,r){\"use strict\";(function(e){var n=r(\"G1u+\");t.a=function(t){for(var r=[0,0,0,0,0,0,0,0],i=e.alloc(Math.ceil(t.length/8)),s=0;s<i.length;s++){for(var o=0;o<8;o++)t[8*s+o]?r[o]=t[8*s+o]:r[o]=0;i[s]=Object(n.a)(r)}return i}}).call(this,r(\"HDXh\").Buffer)},\"ILq/\":function(e,t,r){\"use strict\";(function(e){t.a=function(t,r,n){void 0===n&&(n=!1);for(var i=n?r.length:t.length,s=e.alloc(i),o=0;o<i;o++){var a=n?o%t.length:o;s[o]=~(t[a]|r[o])}return s}}).call(this,r(\"HDXh\").Buffer)},L21C:function(e,t){const r={finalizePair:0,getAddresses:1290,sign:1090,getWallets:142,addAbiDefs:8,test:1646};let n=0;Object.keys(r).forEach(e=>{r[e]+82>n&&(n=r[e]+82)});const i={RESP_SUCCESS:0,RESP_ERR_INVALID_MSG:128,RESP_ERR_UNSUPPORTED_VER:129,RESP_ERR_DEV_BUSY:130,RESP_ERR_USER_TIMEOUT:131,RESP_ERR_USER_DECLINED:132,RESP_ERR_PAIR_FAIL:133,RESP_ERR_PAIR_DISABLED:134,RESP_ERR_PERMISSION_DISABLED:135,RESP_ERR_INTERNAL:136,RESP_ERR_GCE_TIMEOUT:137,RESP_ERR_WALLET_NOT_PRESENT:138,RESP_ERR_DEV_LOCKED:139,RESP_ERR_DISABLED:140,RESP_ERR_ALREADY:141},s={[i.RESP_SUCCESS]:0,[i.RESP_ERR_INVALID_MSG]:\"Invalid Request\",[i.RESP_ERR_UNSUPPORTED_VER]:\"Unsupported Version\",[i.RESP_ERR_DEV_BUSY]:\"Device Busy\",[i.RESP_ERR_USER_TIMEOUT]:\"Timeout Waiting for User\",[i.RESP_ERR_USER_DECLINED]:\"Request Declined by User\",[i.RESP_ERR_PAIR_FAIL]:\"Pairing Failed\",[i.RESP_ERR_PAIR_DISABLED]:\"Pairing is Currently Disabled\",[i.RESP_ERR_PERMISSION_DISABLED]:\"Automated Signing is Currently Disabled\",[i.RESP_ERR_INTERNAL]:\"Device Error\",[i.RESP_ERR_GCE_TIMEOUT]:\"Timeout\",[i.RESP_ERR_WALLET_NOT_PRESENT]:\"Incorrect Wallet UID Provided\",[i.RESP_ERR_DEV_LOCKED]:\"Device Locked\",[i.RESP_ERR_DISABLED]:\"Disabled\",[i.RESP_ERR_ALREADY]:\"Record already exists. You must first remove it on your device.\"};e.exports={getFwVersionConst:function(e){const t={reqMaxDataSz:1152};return 0===e.length||e[1]<10&&0===e[2]?(t.ethMaxDataSz=t.reqMaxDataSz-128,t.ethMaxMsgSz=t.ethMaxDataSz,t.ethMaxGasPrice=5e11,t.addrFlagsAllowed=!1):e[1]>=10&&e[2]>=0&&(t.reqMaxDataSz=1678,t.ethMaxDataSz=t.reqMaxDataSz-128,t.ethMaxMsgSz=t.ethMaxDataSz,t.ethMaxGasPrice=2e13,t.addrFlagsAllowed=!0),t},ADDR_STR_LEN:129,AES_IV:[109,121,115,101,99,114,101,116,112,97,115,115,119,111,114,100],BASE_URL:\"https://signing.gridpl.us\",ENC_MSG_LEN:n,addressSizes:{BTC:20,ETH:20},decResLengths:r,deviceCodes:{CONNECT:1,ENCRYPTED_REQUEST:2},encReqCodes:{FINALIZE_PAIRING:0,GET_ADDRESSES:1,ADD_PERMISSION:2,SIGN_TRANSACTION:3,GET_WALLETS:4,ADD_PERMISSION_V0:5,ADD_ABI_DEFS:6,TEST:7},ethMsgProtocol:{SIGN_PERSONAL:0},messageConstants:{NOT_PAIRED:0,PAIRED:1},responseCodes:i,responseMsgs:s,signingSchema:{BTC_TRANSFER:0,ETH_TRANSFER:1,ERC20_TRANSFER:2,ETH_MSG:3},REQUEST_TYPE_BYTE:2,VERSION_BYTE:1,HARDENED_OFFSET:2147483648,HANDLE_LARGER_CHAIN_ID:255,MAX_CHAIN_ID_BYTES:8,ETH_ABI_LATTICE_FW_TYPE_MAP:{address:1,bool:2,uint8:3,uint16:4,uint32:5,uint64:6,uint128:7,uint256:8,uint:15,bytes1:17,bytes2:18,bytes3:19,bytes4:20,bytes5:21,bytes6:22,bytes7:23,bytes8:24,bytes9:25,bytes10:26,bytes11:27,bytes12:28,bytes13:29,bytes14:30,bytes15:31,bytes16:32,bytes17:33,bytes18:34,bytes19:35,bytes20:36,bytes21:37,bytes22:38,bytes23:39,bytes24:40,bytes25:41,bytes26:42,bytes27:43,bytes28:44,bytes29:45,bytes30:46,bytes31:47,bytes32:48,bytes:49,string:50}}},MbHH:function(e,t,r){const n=r(\"7rlJ\"),i=r(\"HDXh\").Buffer;function s(e,t){if(\"00\"===e.slice(0,2))throw new Error(\"invalid RLP: extra zeros\");return parseInt(e,t)}function o(e,t){if(e<56)return new i([e+t]);var r=c(e),n=c(t+55+r.length/2);return new i(n+r,\"hex\")}function a(e){return\"0x\"===e.slice(0,2)}function c(e){var t=e.toString(16);return t.length%2&&(t=\"0\"+t),t}function u(e){if(!i.isBuffer(e))if(\"string\"===typeof e)e=a(e)?new i(((t=\"string\"!==typeof(r=e)?r:a(r)?r.slice(2):r).length%2&&(t=\"0\"+t),t),\"hex\"):new i(e);else if(\"number\"===typeof e)e=e?function(e){var t=c(e);return new i(t,\"hex\")}(e):new i([]);else if(null===e||void 0===e)e=new i([]);else{if(!e.toArray)throw new Error(\"invalid type\");e=new i(e.toArray())}var t,r;return e}t.encode=function(e){if(e instanceof Array){for(var r=[],n=0;n<e.length;n++)r.push(t.encode(e[n]));var s=i.concat(r);return i.concat([o(s.length,192),s])}return 1===(e=u(e)).length&&e[0]<128?e:i.concat([o(e.length,128),e])},t.decode=function(e,t){if(!e||0===e.length)return new i([]);var r=function e(t){var r,n,o,a,c,u=[],l=t[0];if(l<=127)return{data:t.slice(0,1),remainder:t.slice(1)};if(l<=183){if(r=l-127,o=128===l?new i([]):t.slice(1,r),2===r&&o[0]<128)throw new Error(\"invalid rlp encoding: byte must be less 0x80\");return{data:o,remainder:t.slice(r)}}if(l<=191){if(n=l-182,r=s(t.slice(1,n).toString(\"hex\"),16),(o=t.slice(n,r+n)).length<r)throw new Error(\"invalid RLP\");return{data:o,remainder:t.slice(r+n)}}if(l<=247){for(r=l-191,a=t.slice(1,r);a.length;)c=e(a),u.push(c.data),a=c.remainder;return{data:u,remainder:t.slice(r)}}n=l-246,r=s(t.slice(1,n).toString(\"hex\"),16);var h=n+r;if(h>t.length)throw new Error(\"invalid rlp: total length is larger than the data\");if(0===(a=t.slice(n,h)).length)throw new Error(\"invalid rlp, List has a invalid length\");for(;a.length;)c=e(a),u.push(c.data),a=c.remainder;return{data:u,remainder:t.slice(h)}}(e=u(e));return t?r:(n.equal(r.remainder.length,0,\"invalid remainder\"),r.data)},t.getLength=function(e){if(!e||0===e.length)return new i([]);var t=(e=u(e))[0];if(t<=127)return e.length;if(t<=183)return t-127;if(t<=191)return t-182;if(t<=247)return t-191;var r=t-246;return r+s(e.slice(1,r).toString(\"hex\"),16)}},PLHu:function(e,t,r){const{buildBitcoinTxRequest:n}=r(\"6WMX\"),{buildEthereumTxRequest:i,buildEthereumMsgRequest:s,ensureHexBuffer:o}=r(\"xKF7\"),a=r(\"HDXh\").Buffer,c=r(\"cke4\"),u=r(\"cC09\"),l=r(\"MzeL\"),{AES_IV:h,responseCodes:f,responseMsgs:d,VERSION_BYTE:p}=r(\"L21C\"),g=new(0,l.ec)(\"p256\");function y(e){return u.buf(e)>>>0}const w={BTC:n,ETH:i,ETH_MSG:s};e.exports={isValidAssetPath:function(e){const t=[2147483648,2147483649,2147483708],r=[2147483648];return[2147483697,2147483692].indexOf(e[0])>=0&&t.indexOf(e[1])>=0&&r.indexOf(e[2])>=0&&[0,1].indexOf(e[3])>=0},ensureHexBuffer:o,signReqResolver:w,aes256_decrypt:function(e,t){const r=a.from(h),n=new c.ModeOfOperation.cbc(t,r);return a.from(n.decrypt(e))},aes256_encrypt:function(e,t){const r=a.from(h),n=new c.ModeOfOperation.cbc(t,r),i=e.length%16===0?e:c.padding.pkcs7.pad(e);return a.from(n.encrypt(i))},parseDER:function(e){if(48!==e[0]||2!==e[2])return null;let t=3;const r={r:null,s:null},n=e[t];if(t++,r.r=e.slice(t,t+n),t+=n,2!==e[t])return null;t++;const i=e[t];return t++,r.s=e.slice(t,t+i),r},checksum:y,parseLattice1Response:function(e){const t={err:null,data:null},r=a.from(e,\"hex\");let n=0;const i=r.readUInt8(n);if(n++,i!==p)return t.err=\"Incorrect protocol version. Please update your SDK\",t;const s=r.readUInt8(n);if(n++,0!==s)return t.err=\"Incorrect response from Lattice1\",t;r.readUInt32BE(n),n+=4;const o=r.readUInt16BE(n);n+=2;const c=r.slice(n,n+o);n+=o;const u=c.readUInt8(0);return u!==f.RESP_SUCCESS?(t.err=`Error from device: ${d[u]?d[u]:\"Unknown Error\"}`,t.responseCode=u,t):(t.data=c.slice(1,c.length),r.readUInt32BE(n)!==y(r.slice(0,r.length-4))?(t.err=\"Invalid checksum from device response\",t.data=null,t):t)},getP256KeyPair:function(e){return g.keyFromPrivate(e,\"hex\")},getP256KeyPairFromPub:function(e){return g.keyFromPublic(e,\"hex\")},toPaddedDER:function(e){const t=a.alloc(74);return a.from(e.toDER()).copy(t),t}}},QqcV:function(e,t,r){\"use strict\";var n=r(\"hwdV\").Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError(\"Alphabet too long\");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+\" is ambiguous\");t[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if(\"string\"!==typeof e)throw new TypeError(\"Expected String\");if(0===e.length)return n.alloc(0);var r=0;if(\" \"!==e[r]){for(var i=0,s=0;e[r]===c;)i++,r++;for(var o=(e.length-r)*u+1>>>0,l=new Uint8Array(o);e[r];){var h=t[e.charCodeAt(r)];if(255===h)return;for(var f=0,d=o-1;(0!==h||f<s)&&-1!==d;d--,f++)h+=a*l[d]>>>0,l[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error(\"Non-zero carry\");s=f,r++}if(\" \"!==e[r]){for(var p=o-s;p!==o&&0===l[p];)p++;var g=n.allocUnsafe(i+(o-p));g.fill(0,0,i);for(var y=i;p!==o;)g[y++]=l[p++];return g}}}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError(\"Expected Buffer\");if(0===t.length)return\"\";for(var r=0,i=0,s=0,o=t.length;s!==o&&0===t[s];)s++,r++;for(var u=(o-s)*l+1>>>0,h=new Uint8Array(u);s!==o;){for(var f=t[s],d=0,p=u-1;(0!==f||d<i)&&-1!==p;p--,d++)f+=256*h[p]>>>0,h[p]=f%a>>>0,f=f/a>>>0;if(0!==f)throw new Error(\"Non-zero carry\");i=d,s++}for(var g=u-i;g!==u&&0===h[g];)g++;for(var y=c.repeat(r);g<u;++g)y+=e.charAt(h[g]);return y},decodeUnsafe:h,decode:function(e){var t=h(e);if(t)return t;throw new Error(\"Non-base\"+a+\" character\")}}}},UU9i:function(e,t,r){const n=new(0,r(\"MzeL\").ec)(\"secp256k1\"),i=n.curve,s=i.n.constructor;function o(e){const t=e[0];switch(t){case 2:case 3:return 33!==e.length?null:function(e,t){let r=new s(t);if(r.cmp(i.p)>=0)return null;r=r.toRed(i.red);let o=r.redSqr().redIMul(r).redIAdd(i.b).redSqrt();return 3===e!==o.isOdd()&&(o=o.redNeg()),n.keyPair({pub:{x:r,y:o}})}(t,e.subarray(1,33));case 4:case 6:case 7:return 65!==e.length?null:function(e,t,r){let o=new s(t),a=new s(r);if(o.cmp(i.p)>=0||a.cmp(i.p)>=0)return null;if(o=o.toRed(i.red),a=a.toRed(i.red),(6===e||7===e)&&a.isOdd()!==(7===e))return null;const c=o.redSqr().redIMul(o);return a.redSqr().redISub(c.redIAdd(i.b)).isZero()?n.keyPair({pub:{x:o,y:a}}):null}(t,e.subarray(1,33),e.subarray(33,65));default:return null}}function a(e,t){const r=t.encode(null,33===e.length);for(let n=0;n<e.length;++n)e[n]=r[n]}e.exports={contextRandomize:()=>0,privateKeyVerify(e){const t=new s(e);return t.cmp(i.n)<0&&!t.isZero()?0:1},privateKeyNegate(e){const t=new s(e),r=i.n.sub(t).umod(i.n).toArrayLike(Uint8Array,\"be\",32);return e.set(r),0},privateKeyTweakAdd(e,t){const r=new s(t);if(r.cmp(i.n)>=0)return 1;if(r.iadd(new s(e)),r.cmp(i.n)>=0&&r.isub(i.n),r.isZero())return 1;const n=r.toArrayLike(Uint8Array,\"be\",32);return e.set(n),0},privateKeyTweakMul(e,t){let r=new s(t);if(r.cmp(i.n)>=0||r.isZero())return 1;r.imul(new s(e)),r.cmp(i.n)>=0&&(r=r.umod(i.n));const n=r.toArrayLike(Uint8Array,\"be\",32);return e.set(n),0},publicKeyVerify:e=>null===o(e)?1:0,publicKeyCreate(e,t){const r=new s(t);return r.cmp(i.n)>=0||r.isZero()?1:(a(e,n.keyFromPrivate(t).getPublic()),0)},publicKeyConvert(e,t){const r=o(t);return null===r?1:(a(e,r.getPublic()),0)},publicKeyNegate(e,t){const r=o(t);if(null===r)return 1;const n=r.getPublic();return n.y=n.y.redNeg(),a(e,n),0},publicKeyCombine(e,t){const r=new Array(t.length);for(let i=0;i<t.length;++i)if(r[i]=o(t[i]),null===r[i])return 1;let n=r[0].getPublic();for(let i=1;i<r.length;++i)n=n.add(r[i].pub);return n.isInfinity()?2:(a(e,n),0)},publicKeyTweakAdd(e,t,r){const n=o(t);if(null===n)return 1;if((r=new s(r)).cmp(i.n)>=0)return 2;const c=n.getPublic().add(i.g.mul(r));return c.isInfinity()?2:(a(e,c),0)},publicKeyTweakMul(e,t,r){const n=o(t);return null===n?1:(r=new s(r)).cmp(i.n)>=0||r.isZero()?2:(a(e,n.getPublic().mul(r)),0)},signatureNormalize(e){const t=new s(e.subarray(0,32)),r=new s(e.subarray(32,64));return t.cmp(i.n)>=0||r.cmp(i.n)>=0?1:(1===r.cmp(n.nh)&&e.set(i.n.sub(r).toArrayLike(Uint8Array,\"be\",32),32),0)},signatureExport(e,t){const r=t.subarray(0,32),n=t.subarray(32,64);if(new s(r).cmp(i.n)>=0)return 1;if(new s(n).cmp(i.n)>=0)return 1;const{output:o}=e;let a=o.subarray(4,37);a[0]=0,a.set(r,1);let c=33,u=0;for(;c>1&&0===a[u]&&!(128&a[u+1]);--c,++u);if(a=a.subarray(u),128&a[0])return 1;if(c>1&&0===a[0]&&!(128&a[1]))return 1;let l=o.subarray(39,72);l[0]=0,l.set(n,1);let h=33,f=0;for(;h>1&&0===l[f]&&!(128&l[f+1]);--h,++f);return l=l.subarray(f),128&l[0]?1:h>1&&0===l[0]&&!(128&l[1])?1:(e.outputlen=6+c+h,o[0]=48,o[1]=e.outputlen-2,o[2]=2,o[3]=a.length,o.set(a,4),o[4+c]=2,o[5+c]=l.length,o.set(l,6+c),0)},signatureImport(e,t){if(t.length<8)return 1;if(t.length>72)return 1;if(48!==t[0])return 1;if(t[1]!==t.length-2)return 1;if(2!==t[2])return 1;const r=t[3];if(0===r)return 1;if(5+r>=t.length)return 1;if(2!==t[4+r])return 1;const n=t[5+r];if(0===n)return 1;if(6+r+n!==t.length)return 1;if(128&t[4])return 1;if(r>1&&0===t[4]&&!(128&t[5]))return 1;if(128&t[r+6])return 1;if(n>1&&0===t[r+6]&&!(128&t[r+7]))return 1;let o=t.subarray(4,4+r);if(33===o.length&&0===o[0]&&(o=o.subarray(1)),o.length>32)return 1;let a=t.subarray(6+r);if(33===a.length&&0===a[0]&&(a=a.slice(1)),a.length>32)throw new Error(\"S length is too long\");let c=new s(o);c.cmp(i.n)>=0&&(c=new s(0));let u=new s(t.subarray(6+r));return u.cmp(i.n)>=0&&(u=new s(0)),e.set(c.toArrayLike(Uint8Array,\"be\",32),0),e.set(u.toArrayLike(Uint8Array,\"be\",32),32),0},ecdsaSign(e,t,r,o,a){if(a){const e=a;a=n=>{const i=e(t,r,null,o,n);if(!(i instanceof Uint8Array&&32===i.length))throw new Error(\"This is the way\");return new s(i)}}const c=new s(r);if(c.cmp(i.n)>=0||c.isZero())return 1;let u;try{u=n.sign(t,r,{canonical:!0,k:a,pers:o})}catch(l){return 1}return e.signature.set(u.r.toArrayLike(Uint8Array,\"be\",32),0),e.signature.set(u.s.toArrayLike(Uint8Array,\"be\",32),32),e.recid=u.recoveryParam,0},ecdsaVerify(e,t,r){const a={r:e.subarray(0,32),s:e.subarray(32,64)},c=new s(a.r),u=new s(a.s);if(c.cmp(i.n)>=0||u.cmp(i.n)>=0)return 1;if(1===u.cmp(n.nh)||c.isZero()||u.isZero())return 3;const l=o(r);if(null===l)return 2;const h=l.getPublic();return n.verify(t,a,h)?0:3},ecdsaRecover(e,t,r,o){const c={r:t.slice(0,32),s:t.slice(32,64)},u=new s(c.r),l=new s(c.s);if(u.cmp(i.n)>=0||l.cmp(i.n)>=0)return 1;if(u.isZero()||l.isZero())return 2;let h;try{h=n.recoverPubKey(o,c,r)}catch(f){return 2}return a(e,h),0},ecdh(e,t,r,a,c,u,l){const h=o(t);if(null===h)return 1;const f=new s(r);if(f.cmp(i.n)>=0||f.isZero())return 2;const d=h.getPublic().mul(f);if(void 0===c){const t=d.encode(null,!0),r=n.hash().update(t).digest();for(let n=0;n<32;++n)e[n]=r[n]}else{u||(u=new Uint8Array(32));const t=d.getX().toArray(\"be\",32);for(let e=0;e<32;++e)u[e]=t[e];l||(l=new Uint8Array(32));const r=d.getY().toArray(\"be\",32);for(let e=0;e<32;++e)l[e]=r[e];const n=c(u,l,a);if(!(n instanceof Uint8Array&&n.length===e.length))return 2;e.set(n)}return 0}}},XUzR:function(e,t,r){\"use strict\";(function(e){t.a=function(t,r,n){void 0===n&&(n=!1);for(var i=n?r.length:t.length,s=e.alloc(i),o=0;o<i;o++){var a=n?o%t.length:o;s[o]=t[a]&r[o]}return s}}).call(this,r(\"HDXh\").Buffer)},YnKP:function(e,t,r){\"use strict\";(function(e){t.a=function(t,r,n){void 0===n&&(n=!1);for(var i=n?r.length:t.length,s=e.alloc(i),o=0;o<i;o++){var a=n?o%t.length:o;s[o]=t[a]|r[o]}return s}}).call(this,r(\"HDXh\").Buffer)},a27h:function(e,t,r){e.exports=r(\"mE9w\")(r(\"UU9i\"))},aFzb:function(e,t,r){(function(t){const n=r(\"HEbw\"),i=r(\"+qE3\").EventEmitter,s=r(\"4Mn8\"),o=\"Lattice Hardware\",a=2147483648,c=5,u=-1e3;class l extends i{constructor(e={}){super(),this.type=o,this._resetDefaults(),this.deserialize(e)}deserialize(e={}){return e.creds&&(this.creds=e.creds),e.accounts&&(this.accounts=e.accounts),e.walletUID&&(this.walletUID=e.walletUID),e.name&&(this.name=e.name),e.network&&(this.network=e.network),Promise.resolve()}serialize(){return Promise.resolve({creds:this.creds,accounts:this.accounts,walletUID:this.walletUID,name:this.name,network:this.network})}isUnlocked(){return this._hasCreds()&&this._hasSession()}setHdPath(){console.warn(\"setHdPath not implemented.\")}unlock(e=!0){return new Promise((t,r)=>{this._getCreds().then(e=>(e&&(this.creds.deviceID=e.deviceID,this.creds.password=e.password),this._initSession())).then(()=>this._connect(e)).then(()=>t(\"Unlocked\")).catch(e=>r(Error(e)))})}addAccounts(e=1){return new Promise((t,r)=>e===u?(this.forgetDevice(),t([])):e<=0?r(\"Number of accounts to add must be a positive number.\"):void this.unlock().then(()=>this._fetchAddresses(e,this.unlockedAccount)).then(r=>(this.accounts.splice(this.unlockedAccount,e),this.accounts.splice(this.unlockedAccount,0,...r),t(this.accounts))).catch(e=>r(e)))}getAccounts(){return Promise.resolve(this.accounts?this.accounts.slice():[].slice())}signTransaction(e,r){return new Promise((n,i)=>{this._unlockAndFindAccount(e).then(e=>{const t={chainId:r.getChainId(),nonce:Number(`0x${r.nonce.toString(\"hex\")}`)||0,gasPrice:Number(`0x${r.gasPrice.toString(\"hex\")}`),gasLimit:Number(`0x${r.gasLimit.toString(\"hex\")}`),to:`0x${r.to.toString(\"hex\")}`,value:Number(`0x${r.value.toString(\"hex\")}`),data:0===r.data.length?null:`0x${r.data.toString(\"hex\")}`,signerPath:[a+44,a+60,a,0,e]};return this._signTxData(t)}).then(e=>e.sig&&e.sig.v&&e.sig.r&&e.sig.s?(r.v=e.sig.v,r.r=t.from(e.sig.r,\"hex\"),r.s=t.from(e.sig.s,\"hex\"),n(r)):i(Error(\"No signature returned\"))).catch(e=>i(Error(e)))})}signPersonalMessage(e,t){return this.signMessage(e,{payload:t,protocol:\"signPersonal\"})}signMessage(e,t){return new Promise((r,n)=>{this._unlockAndFindAccount(e).then(e=>{const{payload:i,protocol:s}=t;if(!i||!s)return n(\"`payload` and `protocol` fields must be included in the request\");const o={currency:\"ETH_MSG\",data:{protocol:s,payload:i,signerPath:[a+44,a+60,a,0,e]}};if(!this._hasSession())return n(\"No SDK session started. Cannot sign transaction.\");this.sdkSession.sign(o,(e,t)=>{if(e)return n(e);if(!t.sig)return n(\"No signature returned\");let i=(t.sig.v-27).toString(16);return i.length<2&&(i=`0${i}`),r(`0x${t.sig.r}${t.sig.s}${i}`)})})})}exportAccount(e){return Promise.reject(Error(\"exportAccount not supported by this device\"))}removeAccount(e){this.forgetDevice()}getFirstPage(){return this.page=0,this._getPage(1)}getNextPage(){return this.getFirstPage()}getPreviousPage(){return this.getFirstPage()}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}forgetDevice(){this._resetDefaults()}_unlockAndFindAccount(e){return new Promise((t,r)=>{this.unlock(!1).then(()=>this.getAccounts()).then(n=>{let i=null;return n.forEach((t,r)=>{e.toLowerCase()===t.toLowerCase()&&(i=r)}),null===i?r(\"Signer not present\"):t(i)}).catch(e=>r(e))})}_resetDefaults(){this.accounts=[],this.isLocked=!0,this.creds={deviceID:null,password:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null}_getCreds(){return new Promise((e,t)=>{if(this._hasCreds())return e();const r=this.name?this.name:\"Unknown\";let n=\"https://wallet.gridplus.io\";this.network&&\"mainnet\"!==this.network&&(n=\"https://gridplus-web-wallet-dev.herokuapp.com\");let i=`${n}?keyring=${r}`;this.network&&(i+=`&network=${this.network}`),window.open(i).postMessage(\"GET_LATTICE_CREDS\",n),window.addEventListener(\"message\",(function(r){if(r.origin===n)try{const n=JSON.parse(r.data);return n.deviceID&&n.password?e(n):t(Error(\"Invalid credentials returned from Lattice.\"))}catch(i){return t(i)}}),!1)})}_connect(e){return new Promise((t,r)=>{this.sdkSession.connect(this.creds.deviceID,n=>{if(n)return r(n);const i=this.sdkSession.getActiveWallet();if(!i||!i.uid)return r(\"No active wallet\");const s=i.uid.toString(\"hex\");if(s!=this.walletUID){if(!1===e)return r(\"Wallet has changed! Please reconnect.\");this.accounts=[],this.walletUID=s}return t()})})}_initSession(){return new Promise((e,t)=>{if(this._hasSession())return e();try{let t=\"https://signing.gridpl.us\";this.network&&\"mainnet\"!==this.network&&(t=\"https://signing.staging-gridpl.us\");const r={name:this.name,baseUrl:t,crypto:n,timeout:12e4,privKey:this._genSessionKey(),network:this.network};return this.sdkSession=new s.Client(r),e()}catch(r){return t(r)}})}_fetchAddresses(e=1,t=0){return new Promise((r,n)=>{if(!this._hasSession())return n(\"No SDK session started. Cannot fetch addresses.\");if(t>this.accounts.length)return n(`Requested address is out of bounds. You may only request index <${this.accounts.length}`);if(this.accounts.length>t)return r(this.accounts.slice(t,e));const i={currency:\"ETH\",startPath:[a+44,a+60,a,0,t],n:e};this.sdkSession.getAddresses(i,(e,t)=>e?n(Error(`Error getting addresses: ${e}`)):t.length<1?n(\"No addresses returned\"):r(t))})}_signTxData(e){return new Promise((t,r)=>{if(!this._hasSession())return r(\"No SDK session started. Cannot sign transaction.\");this.sdkSession.sign({currency:\"ETH\",data:e},(e,n)=>e?r(e):n.tx?t(n):r(\"No transaction payload returned.\"))})}_getPage(e=1){return new Promise((t,r)=>{this.page+=e,this.page<=0&&(this.page=1);const n=c*(this.page-1);this.page;this.unlock().then(()=>this._fetchAddresses(1,0)).then(e=>{const r=[];return e.forEach((e,t)=>{r.push({address:e,balance:null,index:n+t})}),t(r)}).catch(e=>r(e))})}_hasCreds(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.name}_hasSession(){return this.sdkSession&&this.walletUID}_genSessionKey(){if(!this._hasCreds())throw new Error(\"No credentials -- cannot create session key!\");const e=t.concat([t.from(this.creds.password),t.from(this.creds.deviceID),t.from(this.name)]);return n.createHash(\"sha256\").update(e).digest()}}l.type=o,e.exports=l}).call(this,r(\"HDXh\").Buffer)},b3gk:function(e,t,r){\"use strict\";var n=r(\"mObS\"),i=r(\"BumV\");e.exports=i((function(e){var t=n(\"sha256\").update(e).digest();return n(\"sha256\").update(t).digest()}))},cC09:function(e,t,r){var n;n=function(e){e.version=\"1.2.0\";var t=function(){for(var e=0,t=new Array(256),r=0;256!=r;++r)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=r)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[r]=e;return\"undefined\"!==typeof Int32Array?new Int32Array(t):t}();e.table=t,e.bstr=function(e,r){for(var n=-1^r,i=e.length-1,s=0;s<i;)n=(n=n>>>8^t[255&(n^e.charCodeAt(s++))])>>>8^t[255&(n^e.charCodeAt(s++))];return s===i&&(n=n>>>8^t[255&(n^e.charCodeAt(s))]),-1^n},e.buf=function(e,r){if(e.length>1e4)return function(e,r){for(var n=-1^r,i=e.length-7,s=0;s<i;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])];for(;s<i+7;)n=n>>>8^t[255&(n^e[s++])];return-1^n}(e,r);for(var n=-1^r,i=e.length-3,s=0;s<i;)n=(n=(n=(n=n>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])];for(;s<i+3;)n=n>>>8^t[255&(n^e[s++])];return-1^n},e.str=function(e,r){for(var n,i,s=-1^r,o=0,a=e.length;o<a;)(n=e.charCodeAt(o++))<128?s=s>>>8^t[255&(s^n)]:n<2048?s=(s=s>>>8^t[255&(s^(192|n>>6&31))])>>>8^t[255&(s^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),i=1023&e.charCodeAt(o++),s=(s=(s=(s=s>>>8^t[255&(s^(240|n>>8&7))])>>>8^t[255&(s^(128|n>>2&63))])>>>8^t[255&(s^(128|i>>6&15|(3&n)<<4))])>>>8^t[255&(s^(128|63&i))]):s=(s=(s=s>>>8^t[255&(s^(224|n>>12&15))])>>>8^t[255&(s^(128|n>>6&63))])>>>8^t[255&(s^(128|63&n))];return-1^s}},\"undefined\"===typeof DO_NOT_EXPORT_CRC?n(t):n({})},cpc2:function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[\"$\"+e]=this._callbacks[\"$\"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks[\"$\"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[\"$\"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks[\"$\"+e],this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks[\"$\"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[\"$\"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},f7RY:function(e,t,r){\"use strict\";(function(e){t.a=function(t){for(var r=e.alloc(t.length),n=0;n<t.length;n++)r[n]=~t[n];return r}}).call(this,r(\"HDXh\").Buffer)},kMlx:function(e,t,r){\"use strict\";var n=r(\"8zgK\");function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||\"object\"!==typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case\"deadline\":this._timeout=e.deadline;break;case\"response\":this._responseTimeout=e.response;break;default:console.warn(\"Unknown timeout option\",t)}return this},i.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var s=[\"ECONNRESET\",\"ETIMEDOUT\",\"EADDRINFO\",\"ESOCKETTIMEDOUT\"];i.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(n){console.error(n)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~s.indexOf(e.code))return!0;if(e.timeout&&\"ECONNABORTED\"==e.code)return!0;if(e.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn(\"Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises\"),this._fullfilledPromise=new Promise((function(e,t){r.end((function(r,n){r?t(r):e(n)}))}))}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if(\"function\"!==typeof e)throw Error(\"Callback required\");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(e,t){if(n(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(\".field(name, val) name can not be empty\");if(this._data&&console.error(\".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()\"),n(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null===t||void 0===t)throw new Error(\".field(name, val) val can not be empty\");return\"boolean\"===typeof t&&(t=\"\"+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit(\"abort\"),this)},i.prototype._auth=function(e,t,r,n){switch(r.type){case\"basic\":this.set(\"Authorization\",\"Basic \"+n(e+\":\"+t));break;case\"auto\":this.username=e,this.password=t;break;case\"bearer\":this.set(\"Authorization\",\"Bearer \"+e)}return this},i.prototype.withCredentials=function(e){return void 0==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.maxResponseSize=function(e){if(\"number\"!==typeof e)throw TypeError(\"Invalid argument\");return this._maxResponseSize=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=n(e),r=this._header[\"content-type\"];if(this._formData&&console.error(\".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()\"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error(\"Can't merge these send calls\");if(t&&n(this._data))for(var i in e)this._data[i]=e[i];else\"string\"==typeof e?(r||this.type(\"form\"),r=this._header[\"content-type\"],this._data=\"application/x-www-form-urlencoded\"==r?this._data?this._data+\"&\"+e:e:(this._data||\"\")+e):this._data=e;return!t||this._isHost(e)?this:(r||this.type(\"json\"),this)},i.prototype.sortQuery=function(e){return this._sort=\"undefined\"===typeof e||e,this},i.prototype._finalizeQueryString=function(){var e=this._query.join(\"&\");if(e&&(this.url+=(this.url.indexOf(\"?\")>=0?\"&\":\"?\")+e),this._query.length=0,this._sort){var t=this.url.indexOf(\"?\");if(t>=0){var r=this.url.substring(t+1).split(\"&\");\"function\"===typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+\"?\"+r.join(\"&\")}}},i.prototype._appendQueryString=function(){console.trace(\"Unsupported\")},i.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=new Error(e+t+\"ms exceeded\");n.timeout=t,n.code=\"ECONNABORTED\",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){e._timeoutError(\"Timeout of \",e._timeout,\"ETIME\")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){e._timeoutError(\"Response timeout of \",e._responseTimeout,\"ETIMEDOUT\")}),this._responseTimeout))}},lghL:function(e,t,r){(function(n,i){var s;!function(){\"use strict\";var o=\"input is invalid type\",a=\"object\"===typeof window,c=a?window:{};c.JS_SHA3_NO_WINDOW&&(a=!1);var u=!a&&\"object\"===typeof self;!c.JS_SHA3_NO_NODE_JS&&\"object\"===typeof n&&n.versions&&n.versions.node?c=i:u&&(c=self);var l=!c.JS_SHA3_NO_COMMON_JS&&\"object\"===typeof e&&e.exports,h=r(\"PDX0\"),f=!c.JS_SHA3_NO_ARRAY_BUFFER&&\"undefined\"!==typeof ArrayBuffer,d=\"0123456789abcdef\".split(\"\"),p=[4,1024,262144,67108864],g=[0,8,16,24],y=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],w=[224,256,384,512],E=[128,256],_=[\"hex\",\"buffer\",\"arrayBuffer\",\"array\",\"digest\"],v={128:168,256:136};!c.JS_SHA3_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return\"[object Array]\"===Object.prototype.toString.call(e)}),!f||!c.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return\"object\"===typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});for(var m=function(e,t,r){return function(n){return new B(e,t,e).update(n)[r]()}},b=function(e,t,r){return function(n,i){return new B(e,t,i).update(n)[r]()}},S=function(e,t,r){return function(t,n,i,s){return T[\"cshake\"+e].update(t,n,i,s)[r]()}},A=function(e,t,r){return function(t,n,i,s){return T[\"kmac\"+e].update(t,n,i,s)[r]()}},R=function(e,t,r,n){for(var i=0;i<_.length;++i){var s=_[i];e[s]=t(r,n,s)}return e},x=function(e,t){var r=m(e,t,\"hex\");return r.create=function(){return new B(e,t,e)},r.update=function(e){return r.create().update(e)},R(r,m,e,t)},I=[{name:\"keccak\",padding:[1,256,65536,16777216],bits:w,createMethod:x},{name:\"sha3\",padding:[6,1536,393216,100663296],bits:w,createMethod:x},{name:\"shake\",padding:[31,7936,2031616,520093696],bits:E,createMethod:function(e,t){var r=b(e,t,\"hex\");return r.create=function(r){return new B(e,t,r)},r.update=function(e,t){return r.create(t).update(e)},R(r,b,e,t)}},{name:\"cshake\",padding:p,bits:E,createMethod:function(e,t){var r=v[e],n=S(e,0,\"hex\");return n.create=function(n,i,s){return i||s?new B(e,t,n).bytepad([i,s],r):T[\"shake\"+e].create(n)},n.update=function(e,t,r,i){return n.create(t,r,i).update(e)},R(n,S,e,t)}},{name:\"kmac\",padding:p,bits:E,createMethod:function(e,t){var r=v[e],n=A(e,0,\"hex\");return n.create=function(n,i,s){return new M(e,t,i).bytepad([\"KMAC\",s],r).bytepad([n],r)},n.update=function(e,t,r,i){return n.create(e,r,i).update(t)},R(n,A,e,t)}}],T={},P=[],k=0;k<I.length;++k)for(var D=I[k],U=D.bits,C=0;C<U.length;++C){var N=D.name+\"_\"+U[C];if(P.push(N),T[N]=D.createMethod(U[C],D.padding),\"sha3\"!==D.name){var L=D.name+U[C];P.push(L),T[L]=T[N]}}function B(e,t,r){this.blocks=[],this.s=[],this.padding=t,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var n=0;n<50;++n)this.s[n]=0}function M(e,t,r){B.call(this,e,t,r)}B.prototype.update=function(e){if(this.finalized)throw new Error(\"finalize already called\");var t,r=typeof e;if(\"string\"!==r){if(\"object\"!==r)throw new Error(o);if(null===e)throw new Error(o);if(f&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!f||!ArrayBuffer.isView(e)))throw new Error(o);t=!0}for(var n,i,s=this.blocks,a=this.byteCount,c=e.length,u=this.blockCount,l=0,h=this.s;l<c;){if(this.reset)for(this.reset=!1,s[0]=this.block,n=1;n<u+1;++n)s[n]=0;if(t)for(n=this.start;l<c&&n<a;++l)s[n>>2]|=e[l]<<g[3&n++];else for(n=this.start;l<c&&n<a;++l)(i=e.charCodeAt(l))<128?s[n>>2]|=i<<g[3&n++]:i<2048?(s[n>>2]|=(192|i>>6)<<g[3&n++],s[n>>2]|=(128|63&i)<<g[3&n++]):i<55296||i>=57344?(s[n>>2]|=(224|i>>12)<<g[3&n++],s[n>>2]|=(128|i>>6&63)<<g[3&n++],s[n>>2]|=(128|63&i)<<g[3&n++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++l)),s[n>>2]|=(240|i>>18)<<g[3&n++],s[n>>2]|=(128|i>>12&63)<<g[3&n++],s[n>>2]|=(128|i>>6&63)<<g[3&n++],s[n>>2]|=(128|63&i)<<g[3&n++]);if(this.lastByteIndex=n,n>=a){for(this.start=n-a,this.block=s[u],n=0;n<u;++n)h[n]^=s[n];H(h),this.reset=!0}else this.start=n}return this},B.prototype.encode=function(e,t){var r=255&e,n=1,i=[r];for(r=255&(e>>=8);r>0;)i.unshift(r),r=255&(e>>=8),++n;return t?i.push(n):i.unshift(n),this.update(i),i.length},B.prototype.encodeString=function(e){var t,r=typeof e;if(\"string\"!==r){if(\"object\"!==r)throw new Error(o);if(null===e)throw new Error(o);if(f&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!f||!ArrayBuffer.isView(e)))throw new Error(o);t=!0}var n=0,i=e.length;if(t)n=i;else for(var s=0;s<e.length;++s){var a=e.charCodeAt(s);a<128?n+=1:a<2048?n+=2:a<55296||a>=57344?n+=3:(a=65536+((1023&a)<<10|1023&e.charCodeAt(++s)),n+=4)}return n+=this.encode(8*n),this.update(e),n},B.prototype.bytepad=function(e,t){for(var r=this.encode(t),n=0;n<e.length;++n)r+=this.encodeString(e[n]);var i=t-r%t,s=[];return s.length=i,this.update(s),this},B.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex,r=this.blockCount,n=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex===this.byteCount)for(e[0]=e[r],t=1;t<r+1;++t)e[t]=0;for(e[r-1]|=2147483648,t=0;t<r;++t)n[t]^=e[t];H(n)}},B.prototype.toString=B.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,s=0,o=0,a=\"\";o<n;){for(s=0;s<t&&o<n;++s,++o)e=r[s],a+=d[e>>4&15]+d[15&e]+d[e>>12&15]+d[e>>8&15]+d[e>>20&15]+d[e>>16&15]+d[e>>28&15]+d[e>>24&15];o%t===0&&(H(r),s=0)}return i&&(e=r[s],a+=d[e>>4&15]+d[15&e],i>1&&(a+=d[e>>12&15]+d[e>>8&15]),i>2&&(a+=d[e>>20&15]+d[e>>16&15])),a},B.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,s=0,o=0,a=this.outputBits>>3;e=i?new ArrayBuffer(n+1<<2):new ArrayBuffer(a);for(var c=new Uint32Array(e);o<n;){for(s=0;s<t&&o<n;++s,++o)c[o]=r[s];o%t===0&&H(r)}return i&&(c[s]=r[s],e=e.slice(0,a)),e},B.prototype.buffer=B.prototype.arrayBuffer,B.prototype.digest=B.prototype.array=function(){this.finalize();for(var e,t,r=this.blockCount,n=this.s,i=this.outputBlocks,s=this.extraBytes,o=0,a=0,c=[];a<i;){for(o=0;o<r&&a<i;++o,++a)e=a<<2,t=n[o],c[e]=255&t,c[e+1]=t>>8&255,c[e+2]=t>>16&255,c[e+3]=t>>24&255;a%r===0&&H(n)}return s&&(e=a<<2,t=n[o],c[e]=255&t,s>1&&(c[e+1]=t>>8&255),s>2&&(c[e+2]=t>>16&255)),c},M.prototype=new B,M.prototype.finalize=function(){return this.encode(this.outputBits,!0),B.prototype.finalize.call(this)};var H=function(e){var t,r,n,i,s,o,a,c,u,l,h,f,d,p,g,w,E,_,v,m,b,S,A,R,x,I,T,P,k,D,U,C,N,L,B,M,H,O,q,z,K,W,F,$,V,G,j,X,Y,J,Q,Z,ee,te,re,ne,ie,se,oe,ae,ce,ue,le;for(n=0;n<48;n+=2)i=e[0]^e[10]^e[20]^e[30]^e[40],s=e[1]^e[11]^e[21]^e[31]^e[41],o=e[2]^e[12]^e[22]^e[32]^e[42],a=e[3]^e[13]^e[23]^e[33]^e[43],c=e[4]^e[14]^e[24]^e[34]^e[44],u=e[5]^e[15]^e[25]^e[35]^e[45],l=e[6]^e[16]^e[26]^e[36]^e[46],h=e[7]^e[17]^e[27]^e[37]^e[47],t=(f=e[8]^e[18]^e[28]^e[38]^e[48])^(o<<1|a>>>31),r=(d=e[9]^e[19]^e[29]^e[39]^e[49])^(a<<1|o>>>31),e[0]^=t,e[1]^=r,e[10]^=t,e[11]^=r,e[20]^=t,e[21]^=r,e[30]^=t,e[31]^=r,e[40]^=t,e[41]^=r,t=i^(c<<1|u>>>31),r=s^(u<<1|c>>>31),e[2]^=t,e[3]^=r,e[12]^=t,e[13]^=r,e[22]^=t,e[23]^=r,e[32]^=t,e[33]^=r,e[42]^=t,e[43]^=r,t=o^(l<<1|h>>>31),r=a^(h<<1|l>>>31),e[4]^=t,e[5]^=r,e[14]^=t,e[15]^=r,e[24]^=t,e[25]^=r,e[34]^=t,e[35]^=r,e[44]^=t,e[45]^=r,t=c^(f<<1|d>>>31),r=u^(d<<1|f>>>31),e[6]^=t,e[7]^=r,e[16]^=t,e[17]^=r,e[26]^=t,e[27]^=r,e[36]^=t,e[37]^=r,e[46]^=t,e[47]^=r,t=l^(i<<1|s>>>31),r=h^(s<<1|i>>>31),e[8]^=t,e[9]^=r,e[18]^=t,e[19]^=r,e[28]^=t,e[29]^=r,e[38]^=t,e[39]^=r,e[48]^=t,e[49]^=r,p=e[0],g=e[1],G=e[11]<<4|e[10]>>>28,j=e[10]<<4|e[11]>>>28,P=e[20]<<3|e[21]>>>29,k=e[21]<<3|e[20]>>>29,ae=e[31]<<9|e[30]>>>23,ce=e[30]<<9|e[31]>>>23,W=e[40]<<18|e[41]>>>14,F=e[41]<<18|e[40]>>>14,L=e[2]<<1|e[3]>>>31,B=e[3]<<1|e[2]>>>31,w=e[13]<<12|e[12]>>>20,E=e[12]<<12|e[13]>>>20,X=e[22]<<10|e[23]>>>22,Y=e[23]<<10|e[22]>>>22,D=e[33]<<13|e[32]>>>19,U=e[32]<<13|e[33]>>>19,ue=e[42]<<2|e[43]>>>30,le=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,re=e[4]<<30|e[5]>>>2,M=e[14]<<6|e[15]>>>26,H=e[15]<<6|e[14]>>>26,_=e[25]<<11|e[24]>>>21,v=e[24]<<11|e[25]>>>21,J=e[34]<<15|e[35]>>>17,Q=e[35]<<15|e[34]>>>17,C=e[45]<<29|e[44]>>>3,N=e[44]<<29|e[45]>>>3,R=e[6]<<28|e[7]>>>4,x=e[7]<<28|e[6]>>>4,ne=e[17]<<23|e[16]>>>9,ie=e[16]<<23|e[17]>>>9,O=e[26]<<25|e[27]>>>7,q=e[27]<<25|e[26]>>>7,m=e[36]<<21|e[37]>>>11,b=e[37]<<21|e[36]>>>11,Z=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,$=e[8]<<27|e[9]>>>5,V=e[9]<<27|e[8]>>>5,I=e[18]<<20|e[19]>>>12,T=e[19]<<20|e[18]>>>12,se=e[29]<<7|e[28]>>>25,oe=e[28]<<7|e[29]>>>25,z=e[38]<<8|e[39]>>>24,K=e[39]<<8|e[38]>>>24,S=e[48]<<14|e[49]>>>18,A=e[49]<<14|e[48]>>>18,e[0]=p^~w&_,e[1]=g^~E&v,e[10]=R^~I&P,e[11]=x^~T&k,e[20]=L^~M&O,e[21]=B^~H&q,e[30]=$^~G&X,e[31]=V^~j&Y,e[40]=te^~ne&se,e[41]=re^~ie&oe,e[2]=w^~_&m,e[3]=E^~v&b,e[12]=I^~P&D,e[13]=T^~k&U,e[22]=M^~O&z,e[23]=H^~q&K,e[32]=G^~X&J,e[33]=j^~Y&Q,e[42]=ne^~se&ae,e[43]=ie^~oe&ce,e[4]=_^~m&S,e[5]=v^~b&A,e[14]=P^~D&C,e[15]=k^~U&N,e[24]=O^~z&W,e[25]=q^~K&F,e[34]=X^~J&Z,e[35]=Y^~Q&ee,e[44]=se^~ae&ue,e[45]=oe^~ce&le,e[6]=m^~S&p,e[7]=b^~A&g,e[16]=D^~C&R,e[17]=U^~N&x,e[26]=z^~W&L,e[27]=K^~F&B,e[36]=J^~Z&$,e[37]=Q^~ee&V,e[46]=ae^~ue&te,e[47]=ce^~le&re,e[8]=S^~p&w,e[9]=A^~g&E,e[18]=C^~R&I,e[19]=N^~x&T,e[28]=W^~L&M,e[29]=F^~B&H,e[38]=Z^~$&G,e[39]=ee^~V&j,e[48]=ue^~te&ne,e[49]=le^~re&ie,e[0]^=y[n],e[1]^=y[n+1]};if(l)e.exports=T;else{for(k=0;k<P.length;++k)c[P[k]]=T[P[k]];h&&(void 0===(s=function(){return T}.call(t,r,t,e))||(e.exports=s))}}()}).call(this,r(\"8oxB\"),r(\"yLpj\"))},mE9w:function(e,t){const r=\"Impossible case. Please create issue.\",n=\"The tweak was out of range or the resulted private key is invalid\",i=\"The tweak was out of range or equal to zero\",s=\"Unknow error on context randomization\",o=\"Private Key is invalid\",a=\"Public Key could not be parsed\",c=\"Public Key serialization error\",u=\"The sum of the public keys is not valid\",l=\"Signature could not be parsed\",h=\"The nonce generation function failed, or the private key was invalid\",f=\"Public key could not be recover\",d=\"Scalar was invalid (zero or overflow)\";function p(e,t){if(!e)throw new Error(t)}function g(e,t,r){if(p(t instanceof Uint8Array,`Expected ${e} to be an Uint8Array`),void 0!==r)if(Array.isArray(r)){const n=`Expected ${e} to be an Uint8Array with length [${r.join(\", \")}]`;p(r.includes(t.length),n)}else{const n=`Expected ${e} to be an Uint8Array with length ${r}`;p(t.length===r,n)}}function y(e){p(\"Boolean\"===E(e),\"Expected compressed to be a Boolean\")}function w(e=(e=>new Uint8Array(e)),t){return\"function\"===typeof e&&(e=e(t)),g(\"output\",e,t),e}function E(e){return Object.prototype.toString.call(e).slice(8,-1)}e.exports=e=>({contextRandomize(t){switch(p(null===t||t instanceof Uint8Array,\"Expected seed to be an Uint8Array or null\"),null!==t&&g(\"seed\",t,32),e.contextRandomize(t)){case 1:throw new Error(s)}},privateKeyVerify:t=>(g(\"private key\",t,32),0===e.privateKeyVerify(t)),privateKeyNegate(t){switch(g(\"private key\",t,32),e.privateKeyNegate(t)){case 0:return t;case 1:throw new Error(r)}},privateKeyTweakAdd(t,r){switch(g(\"private key\",t,32),g(\"tweak\",r,32),e.privateKeyTweakAdd(t,r)){case 0:return t;case 1:throw new Error(n)}},privateKeyTweakMul(t,r){switch(g(\"private key\",t,32),g(\"tweak\",r,32),e.privateKeyTweakMul(t,r)){case 0:return t;case 1:throw new Error(i)}},publicKeyVerify:t=>(g(\"public key\",t,[33,65]),0===e.publicKeyVerify(t)),publicKeyCreate(t,r=!0,n){switch(g(\"private key\",t,32),y(r),n=w(n,r?33:65),e.publicKeyCreate(n,t)){case 0:return n;case 1:throw new Error(o);case 2:throw new Error(c)}},publicKeyConvert(t,r=!0,n){switch(g(\"public key\",t,[33,65]),y(r),n=w(n,r?33:65),e.publicKeyConvert(n,t)){case 0:return n;case 1:throw new Error(a);case 2:throw new Error(c)}},publicKeyNegate(t,n=!0,i){switch(g(\"public key\",t,[33,65]),y(n),i=w(i,n?33:65),e.publicKeyNegate(i,t)){case 0:return i;case 1:throw new Error(a);case 2:throw new Error(r);case 3:throw new Error(c)}},publicKeyCombine(t,r=!0,n){p(Array.isArray(t),\"Expected public keys to be an Array\"),p(t.length>0,\"Expected public keys array will have more than zero items\");for(const e of t)g(\"public key\",e,[33,65]);switch(y(r),n=w(n,r?33:65),e.publicKeyCombine(n,t)){case 0:return n;case 1:throw new Error(a);case 2:throw new Error(u);case 3:throw new Error(c)}},publicKeyTweakAdd(t,r,i=!0,s){switch(g(\"public key\",t,[33,65]),g(\"tweak\",r,32),y(i),s=w(s,i?33:65),e.publicKeyTweakAdd(s,t,r)){case 0:return s;case 1:throw new Error(a);case 2:throw new Error(n)}},publicKeyTweakMul(t,r,n=!0,s){switch(g(\"public key\",t,[33,65]),g(\"tweak\",r,32),y(n),s=w(s,n?33:65),e.publicKeyTweakMul(s,t,r)){case 0:return s;case 1:throw new Error(a);case 2:throw new Error(i)}},signatureNormalize(t){switch(g(\"signature\",t,64),e.signatureNormalize(t)){case 0:return t;case 1:throw new Error(l)}},signatureExport(t,n){g(\"signature\",t,64);const i={output:n=w(n,72),outputlen:72};switch(e.signatureExport(i,t)){case 0:return n.slice(0,i.outputlen);case 1:throw new Error(l);case 2:throw new Error(r)}},signatureImport(t,n){switch(g(\"signature\",t),n=w(n,64),e.signatureImport(n,t)){case 0:return n;case 1:throw new Error(l);case 2:throw new Error(r)}},ecdsaSign(t,n,i={},s){g(\"message\",t,32),g(\"private key\",n,32),p(\"Object\"===E(i),\"Expected options to be an Object\"),void 0!==i.data&&g(\"options.data\",i.data),void 0!==i.noncefn&&p(\"Function\"===E(i.noncefn),\"Expected options.noncefn to be a Function\");const o={signature:s=w(s,64),recid:null};switch(e.ecdsaSign(o,t,n,i.data,i.noncefn)){case 0:return o;case 1:throw new Error(h);case 2:throw new Error(r)}},ecdsaVerify(t,r,n){switch(g(\"signature\",t,64),g(\"message\",r,32),g(\"public key\",n,[33,65]),e.ecdsaVerify(t,r,n)){case 0:return!0;case 3:return!1;case 1:throw new Error(l);case 2:throw new Error(a)}},ecdsaRecover(t,n,i,s=!0,o){switch(g(\"signature\",t,64),p(\"Number\"===E(n)&&n>=0&&n<=3,\"Expected recovery id to be a Number within interval [0, 3]\"),g(\"message\",i,32),y(s),o=w(o,s?33:65),e.ecdsaRecover(o,t,n,i)){case 0:return o;case 1:throw new Error(l);case 2:throw new Error(f);case 3:throw new Error(r)}},ecdh(t,r,n={},i){switch(g(\"public key\",t,[33,65]),g(\"private key\",r,32),p(\"Object\"===E(n),\"Expected options to be an Object\"),void 0!==n.data&&g(\"options.data\",n.data),void 0!==n.hashfn?(p(\"Function\"===E(n.hashfn),\"Expected options.hashfn to be a Function\"),void 0!==n.xbuf&&g(\"options.xbuf\",n.xbuf,32),void 0!==n.ybuf&&g(\"options.ybuf\",n.ybuf,32),g(\"output\",i)):i=w(i,32),e.ecdh(i,t,r,n.data,n.hashfn,n.xbuf,n.ybuf)){case 0:return i;case 1:throw new Error(a);case 2:throw new Error(d)}}})},nMdu:function(e,t,r){\"use strict\";(function(e){t.a=function(t,r,n){void 0===n&&(n=!1);for(var i=n?r.length:t.length,s=e.alloc(i),o=0;o<i;o++){var a=n?o%t.length:o;s[o]=~(t[a]&r[o])}return s}}).call(this,r(\"HDXh\").Buffer)},nZbv:function(e,t){function r(){this._defaults=[]}[\"use\",\"on\",\"once\",\"set\",\"query\",\"type\",\"accept\",\"auth\",\"withCredentials\",\"sortQuery\",\"retry\",\"ok\",\"redirects\",\"timeout\",\"buffer\",\"serialize\",\"parse\",\"ca\",\"key\",\"pfx\",\"cert\"].forEach((function(e){r.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}})),r.prototype._setDefaults=function(e){this._defaults.forEach((function(t){e[t.fn].apply(e,t.arguments)}))},e.exports=r},oHnp:function(e,t,r){\"use strict\";t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce((function(e,t){var r=t.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(e[n]=i),e}),{})},t.parseLinks=function(e){return e.split(/ *, */).reduce((function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e}),{})},t.cleanHeader=function(e,t){return delete e[\"content-type\"],delete e[\"content-length\"],delete e[\"transfer-encoding\"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},pzNo:function(e,t,r){const n=r(\"2k3W\"),i=r(\"24Ii\"),s=r(\"6WMX\"),o=r(\"xKF7\"),{buildAddAbiPayload:a,abiParsers:c,MAX_ABI_DEFS:u}=r(\"u0zn\"),{isValidAssetPath:l,signReqResolver:h,aes256_decrypt:f,aes256_encrypt:d,parseDER:p,checksum:g,ensureHexBuffer:y,getP256KeyPair:w,getP256KeyPairFromPub:E,parseLattice1Response:_,toPaddedDER:v}=r(\"PLHu\"),{getFwVersionConst:m,ADDR_STR_LEN:b,ENC_MSG_LEN:S,decResLengths:A,deviceCodes:R,encReqCodes:x,responseCodes:I,REQUEST_TYPE_BYTE:T,VERSION_BYTE:P,messageConstants:k,BASE_URL:D}=r(\"L21C\"),U=r(\"HDXh\").Buffer,C=U.alloc(32);e.exports=class{constructor({baseUrl:e,crypto:t,name:r,privKey:n,timeout:i,retryCount:s}={}){if(r&&r.length>24)throw new Error(\"name must be less than 24 characters\");if(!t)throw new Error(\"crypto provider is required\");this.baseUrl=e||D,this.crypto=t,this.name=r||\"Unknown\",this.privKey=n||this.crypto.randomBytes(32),this.key=w(this.privKey),this.ephemeralPub=null,this.sharedSecret=null,this.timeout=i||6e4,this.deviceId=null,this.isPaired=!1,this.retryCount=s||3,this.activeWallets={internal:{uid:C,name:null,capabilities:null,external:!1},external:{uid:C,name:null,capabilities:null,external:!0}}}connect(e,t){if(\"function\"===typeof e){if(!this.deviceId)return t(\"No device ID has been stored. Please connect with your device ID first.\");t=e}else this.deviceId=e;const r=this._buildRequest(R.CONNECT,this.pubKeyBytes());this._request(r,(e,r)=>e?t(e):(this.isPaired=this._handleConnect(r),this.isPaired?void this._getActiveWallet(e=>t(e,this.isPaired),!0):t(null)))}pair(e,t){const r=this.pubKeyBytes(),n=U.alloc(25);if(this.name.length>24)return t(\"Name is too many characters. Please change it to <25 characters.\");n.write(this.name);const i=U.concat([r,n,U.from(e)]),s=this.crypto.createHash(\"sha256\").update(i).digest(),o=this.key.sign(s),a=v(o),c=U.concat([n,a]),u=this._buildEncRequest(x.FINALIZE_PAIRING,c);this._request(u,(e,r)=>{if(e)return t(e);const n=this._handlePair(r);if(n)return t(n);this._getActiveWallet(e=>e?t(e):t(null,this.hasActiveWallet()),!0)})}test(e,t){if(!e.payload)return t(\"First argument must contain `testID` and `payload` fields.\");const r=U.alloc(506);r.writeUInt32BE(e.testID,0),r.writeUInt16BE(e.payload.length,4),e.payload.copy(r,6);const n=this._buildEncRequest(x.TEST,r);this._request(n,(e,r)=>{if(e)return t(e);const n=this._handleEncResponse(r,A.test);return null!==n.err?t(n.err):t(null,n.data.slice(65))})}getAddresses(e,t){const{startPath:r,n:i,skipCache:s=!0}=e;if(void 0===r||void 0===i||5!==r.length)return t(\"Please provide `startPath` and `n` options\");if(i>10)return t(\"You may only request 10 addresses at once.\");if(!0===s&&!1===l(r))return t(\"Parent path is not supported\");const o=U.alloc(33+4*r.length);let a=0;const c=this.getActiveWallet();if(null===c)return t(\"No active wallet.\");c.uid.copy(o,a),a+=32;for(let n=0;n<r.length;n++)o.writeUInt32BE(r[n],a),a+=4;let u;if(!0===m(this.fwVersion).addrFlagsAllowed){const e=!0===s?n.nibble.read(1):n.nibble.read(0),t=n.nibble.read(i);u=n.byte.write(e.concat(t))}else u=i;o.writeUInt8(u,a),a++;const h=this._buildEncRequest(x.GET_ADDRESSES,o);return this._request(h,(e,r)=>{if(e)return t(e);const n=this._handleGetAddresses(r);return n.err?t(n.err):t(null,n.data)})}sign(e,t){const{currency:r,data:n}=e;if(void 0===r||void 0===n)return t(\"Please provide `currency` and `data` options\");if(void 0===h[r])return t(\"Unsupported currency\");const i=m(this.fwVersion);n.ethMaxDataSz=i.ethMaxDataSz,n.ethMaxMsgSz=i.ethMaxMsgSz;const s=h[r](n);if(void 0!==s.err)return t({err:s.err});if(s.payload.length>i.reqMaxDataSz)return t(\"Transaction is too large\");const o=U.alloc(2+i.reqMaxDataSz);let a=0;o.writeUInt16BE(s.schema,a),a+=2;const c=this.getActiveWallet();if(null===c)return t(\"No active wallet.\");c.uid.copy(o,a),a+=c.uid.length,s.payload.copy(o,a);const u=this._buildEncRequest(x.SIGN_TRANSACTION,o);return this._request(u,(n,i,o)=>{if(o===I.RESP_ERR_WALLET_NOT_PRESENT)this._getActiveWallet(r=>r?t(r):this.sign(e,t));else{if(!n){const e=this._handleSign(i,r,s);return t(e.err,e.data)}if(n)return t(n)}})}addAbiDefs(e,t,r=null){const n=e.slice(0,u);let i;e=e.slice(u);try{i=a(n)}catch(c){return t(c)}const s=U.alloc(i.length+10);s.writeUInt16LE(e.length),null!==r&&r.copy(s,2),i.copy(s,10);const o=this._buildEncRequest(x.ADD_ABI_DEFS,s);return this._request(o,(n,i,s)=>{if(s&&s!==I.RESP_SUCCESS)return t(\"Error making request.\");if(n)return t(n);const o=this._handleEncResponse(i,A.addAbiDefs);if(r=o.data.slice(65,73),0===e.length)return t(null);this.addAbiDefs(e,t,r,e)})}addPermissionV0(e,t){const{currency:r,timeWindow:n,limit:i,decimals:s,asset:o}=e;if(!r||void 0===n||void 0===i||void 0===s||null===n||null===i||null===s)return t(\"currency, timeWindow, decimals, and limit are all required options.\");if(0===n||0===i)return t(\"Time window and spending limit must be positive.\");let a=r;o&&(a+=`_${o}`);const c=U.alloc(293);if(U.from(a).length>255)return t(\"Asset name too long.\");U.from(a).copy(c,0);const u=y(i);if(u.length>32)return t(\"Limit too large.\");u.copy(c,32-u.length+256),c.writeUInt32BE(n,288),c.writeUInt8(s,292);const l=this._buildEncRequest(x.ADD_PERMISSION_V0,c);return this._request(l,(r,n,i)=>{if(i===I.RESP_ERR_WALLET_NOT_PRESENT)this._getActiveWallet(r=>r?t(r):this.addPermissionV0(e,t));else{if(!r){const e=this._handleEncResponse(n,A.finalizePair);return e.err?t(e.err):t(null)}if(r)return t(r)}})}_getActiveWallet(e,t=!1){if(!0===t||!0!==this.hasActiveWallet()&&!0===this.isPaired){const t=U.alloc(0),r=this._buildEncRequest(x.GET_WALLETS,t);return this._request(r,(t,r)=>t?(this._resetActiveWallets(),e(t)):e(this._handleGetWallets(r)))}return e(null)}_getSharedSecret(){return U.from(this.key.derive(this.ephemeralPub.getPublic()).toArray(\"be\",32))}_getEphemId(){if(null===this.ephemeralPub)return null;const e=this._getSharedSecret();return this.crypto.createHash(\"sha256\").update(e).digest().slice(0,4)}_buildEncRequest(e,t){const r=parseInt(this._getEphemId().toString(\"hex\"),16),n=U.concat([U.from([e]),t]),i=g(n),s=U.alloc(n.length+4);n.copy(s,0),s.writeUInt32LE(i,n.length);const o=this._getSharedSecret(),a=d(s,o),c=U.alloc(S+4);return c.writeUInt32LE(r,0),a.copy(c,4),this._buildRequest(R.ENCRYPTED_REQUEST,c)}_buildRequest(e,t){let r=t&&U.isBuffer(t)?t.length+1:1;e===R.ENCRYPTED_REQUEST&&(r=1+t.length);let n=0;const i=U.alloc(r+8);n=i.writeUInt8(P,n),n=i.writeUInt8(T,n);const s=this.crypto.randomBytes(4);n=i.writeUInt32BE(parseInt(`0x${s.toString(\"hex\")}`),n),n=i.writeUInt16BE(r,n),n=i.writeUInt8(e,n),r>1&&(n=t.copy(i,n));const o=g(i),a=U.alloc(i.length+4);return n=i.copy(a),a.writeUInt32BE(o,n),a}_request(e,t,r=this.retryCount){if(!this.deviceId)return t(\"Serial is not set. Please set it and try again.\");const n=`${this.baseUrl}/${this.deviceId}`;i.post(n).timeout(this.timeout).send({data:e}).then(n=>{if(!n||!n.body)return t(`Invalid response: ${n}`);if(200!==n.body.status)return t(`Error code ${n.body.status}: ${n.body.message}`);const i=_(n.body.message);return(i.responseCode===I.RESP_ERR_DEV_BUSY||i.responseCode===I.RESP_ERR_GCE_TIMEOUT)&&r>0?setTimeout(()=>{this._request(e,t,r-1)},3e3):(i.responseCode===I.RESP_ERR_WALLET_NOT_PRESENT&&this._resetActiveWallets(),i.err?t(i.err):t(null,i.data,i.responseCode))}).catch(e=>{const r=\"ECONNABORTED\"===e.code&&\"ETIME\"===e.errno;return t(r?\"Timeout waiting for device. Please ensure it is connected to the internet and try again in a minute.\":\"Failed to make request to device.\")})}_handleConnect(e){let t=0;const r=e.readUInt8(t);t++;const n=e.slice(t,t+65).toString(\"hex\");return t+=65,this.fwVersion=e.slice(t,t+4),this.ephemeralPub=E(n),r===k.PAIRED}_handleEncResponse(e,t){const r=this._getSharedSecret(),n=e.slice(0,S),i=f(n,r);t+=65;const s=i.slice(0,t),o=parseInt(`0x${i.slice(t,t+4).toString(\"hex\")}`),a=g(s);if(o!==a)return{err:`Checksum mismatch in response from Lattice (calculated ${a}, wanted ${o})`};const c=i.slice(0,65).toString(\"hex\");try{return this.ephemeralPub=E(c),{err:null,data:i}}catch(u){return{err:`Error handling getAddresses response: ${u.toString()}`}}}_handlePair(e){const t=this._handleEncResponse(e,A.finalizePair);return t.err?t.err:(this.pairingSalt=null,this.isPaired=!0,null)}_handleGetAddresses(e){const t=this._handleEncResponse(e,A.getAddresses);if(null!==t.err)return t;const r=t.data;let n=65;const i=[];for(;n+4<A.getAddresses;){const e=r.slice(n,n+b);n+=b;const t=e.indexOf(0);t>0&&i.push(e.slice(0,t).toString())}return{data:i,err:null}}_handleGetWallets(e){const t=this._handleEncResponse(e,A.getWallets);if(null!==t.err)return t;const r=t.data;let n;let i=65,s=!1;return n=r.slice(i,i+32),this.activeWallets.internal.uid=n,this.activeWallets.internal.capabilities=r.readUInt32BE(i+32),this.activeWallets.internal.name=r.slice(i+36,i+71),n.equals(C)||(s=!0),i+=71,n=r.slice(i,i+32),this.activeWallets.external.uid=n,this.activeWallets.external.capabilities=r.readUInt32BE(i+32),this.activeWallets.external.name=r.slice(i+36,i+71),n.equals(C)||(s=!0),!0===s?null:\"No active wallet.\"}_handleSign(e,t,r=null){const n=this._handleEncResponse(e,A.sign);if(null!==n.err)return{err:n.err};let i=65;const a=n.data;let c;if(\"BTC\"===t){const e=s.addressVersion[r.changeData.changeVersion],t=a.slice(i,i+20);i+=20,c=s.getBitcoinAddress(t,e)}const u={err:null,data:null};if(\"BTC\"===t){const e=33,t=[],n=[];let o=0;for(;i<a.length&&48===a[i];){const r=i,s=i+2+a[i+1];n.push(a.slice(r,s));const c=o*e+825,u=(o+1)*e+825;t.push(a.slice(c,u)),i+=74,o+=1}const l={inputs:[],outputs:[],isSegwitSpend:r.origData.isSegwit,network:r.origData.network,crypto:this.crypto};l.outputs.push({value:r.origData.value,recipient:r.origData.recipient}),r.changeData.value>0&&l.outputs.push({value:r.changeData.value,recipient:c});for(let i=0;i<n.length;i++)l.inputs.push({hash:r.origData.prevOuts[i].txHash,index:r.origData.prevOuts[i].index,sig:n[i],pubkey:t[i]});const h=s.serializeTx(l);let f=h;!0===l.isSegwitSpend&&(l.isSegwitSpend=!1,f=s.serializeTx(l));let d=this.crypto.createHash(\"sha256\").update(U.from(f,\"hex\")).digest();d=this.crypto.createHash(\"sha256\").update(d).digest().reverse().toString(\"hex\"),u.data={tx:h,txHash:d,changeRecipient:c,sigs:n}}else if(\"ETH\"===t){const e=p(a.slice(i,i+2+a[i+1]));i+=74;const t=a.slice(i,i+20),n=o.buildEthRawTx(r,e,t,r.useEIP155);u.data={tx:`0x${n}`,txHash:`0x${o.hashTransaction(n)}`,sig:{v:e.v,r:e.r.toString(\"hex\"),s:e.s.toString(\"hex\")},signer:t}}else if(\"ETH_MSG\"===t){const e=p(a.slice(i,i+2+a[i+1]));i+=74;const t=a.slice(i,i+20),n=o.validateEthereumMsgResponse({signer:t,sig:e},r);u.data={sig:{v:n.v,r:n.r.toString(\"hex\"),s:n.s.toString(\"hex\")},signer:t}}return u}_resetActiveWallets(){this.activeWallets.internal.uid=C,this.activeWallets.internal.name=null,this.activeWallets.internal.capabilities=null,this.activeWallets.external.uid=C,this.activeWallets.external.name=null,this.activeWallets.external.capabilities=null}getActiveWallet(){return C.equals(this.activeWallets.external.uid)?C.equals(this.activeWallets.internal.uid)?null:this.activeWallets.internal:this.activeWallets.external}hasActiveWallet(){return null!==this.getActiveWallet()}pubKeyBytes(e=!1){const t=this.key.getPublic().encode(\"hex\"),r=U.from(t,\"hex\");if(!0===e){const e=r.slice(1,33).reverse(),t=r.slice(33,65).reverse();return U.concat([r[0],e,t])}return r}parseAbi(e,t){switch(e){case\"etherscan\":return c[e](t);default:return{err:`No ${e} parser available.`}}}}},u0zn:function(e,t,r){const n=r(\"HDXh\").Buffer,i=r(\"lghL\").keccak256,{ETH_ABI_LATTICE_FW_TYPE_MAP:s}=r(\"L21C\");t.MAX_ABI_DEFS=2,t.buildAddAbiPayload=function(e){if(!e||!Array.isArray(e))throw new Error(\"Missing definitions.\");if(e.length>t.MAX_ABI_DEFS)throw new Error(\"You may only add 2 ABI definitions per request.\");const r=n.alloc(1147);let i=0;return r.writeUInt8(e.length,i),i++,e.forEach(e=>{if(!e.sig||!e.name||!e.params)throw new Error(\"name, sig, and params must be present for every ABI definition.\");const t=n.from(e.sig,\"hex\");if(4!==t.length)throw new Error(\"Function signatures must always be four bytes.\");if(t.copy(r,i),i+=t.length,n.from(e.name).length>99)throw new Error(\"Only function names shorter than 100 characters are supported.\");n.from(e.name).slice(0,100).copy(r,i),i+=100;const s=Array.isArray(e.params)?e.params.length:0;if(r.writeUInt8(s,i),i++,s>18)throw new Error(\"Currently only ABI defintions with <=10 parameters are supported.\");s>0?(e.params.forEach(e=>{if(!e.name||!e.latticeTypeIdx||void 0===e.isArray||void 0===e.arraySz)throw new Error(\"name, latticeTypeIdx, isArray, and arraySz must be defined for all ABI params.\");n.from(e.name).slice(0,20).copy(r,i),i+=20}),i+=20*(18-s),e.params.forEach(e=>{r.writeUInt8(e.latticeTypeIdx,i),i++,r.writeUInt8(!0===e.isArray,i),i++,r.writeUInt32LE(e.arraySz,i),i+=4}),i+=6*(18-s)):i+=468}),r},t.abiParsers={etherscan:function(e){const t=[];return e.forEach(e=>{if(e.name&&e.inputs&&\"function\"===e.type&&\"view\"!==e.stateMutability){const r=function(e){let t=`${e.name}(`;e.inputs.forEach(e=>{t+=`${e.type},`}),e.inputs.length>0&&(t=t.slice(0,t.length-1));return t+=\")\",i(t).slice(0,8)}(e),n=function(e){const t=[];return e.forEach(e=>{const r=e.type,n={isArray:!1,arraySz:0,name:e.name},i=r.indexOf(\"[\"),o=r.indexOf(\"]\");if(i>-1&&o>-1)if(i>=o);else if(i+1===o)n.isArray=!0;else{const e=parseInt(r.slice(i,o));if(isNaN(e))return n;n.isArray=!0,n.arraySz=e}const a=i>-1?r.slice(0,i):r;if(n.latticeTypeIdx=function(e){return s[e]}(a),!n.latticeTypeIdx)throw new Error(`Unsupported type: ${r}`);t.push(n)}),t}(e.inputs);t.push({name:e.name,sig:r,params:n})}}),t}}},vGFC:function(e,t,r){\"use strict\";(function(e){t.a=function(t,r,n){void 0===n&&(n=!1);for(var i=n?r.length:t.length,s=e.alloc(i),o=0;o<i;o++){var a=n?o%t.length:o;s[o]=~(t[a]^r[o])}return s}}).call(this,r(\"HDXh\").Buffer)},xKF7:function(e,t,r){const n=r(\"kB5k\"),i=r(\"HDXh\").Buffer,s=r(\"L21C\"),o=r(\"lghL\").keccak256,a=r(\"MbHH\"),c=r(\"a27h\");function u(e){let t=e[0];for(;e.length>0&&\"0\"===t.toString();)t=(e=e.slice(1))[0];return e}function l(e,t,r,n,s){try{const a=new Uint8Array(i.from(o(e),\"hex\"));let u=0;const l=f(t.r,32);t.r=l;const p=f(t.s,32);t.s=p;const g=new Uint8Array(i.concat([l,p]));let y=c.ecdsaRecover(g,u,a,!1).slice(1);if(h(y)===r.toString(\"hex\"))return t.v=d(u,s,n),t;if(u=1,y=c.ecdsaRecover(g,u,a,!1).slice(1),h(y)===r.toString(\"hex\"))return t.v=d(u,s,n),t;throw new Error(\"Invalid Ethereum signature returned.\")}catch(a){throw new Error(a)}}function h(e){return o(e).slice(-40)}function f(e,t){const r=i.alloc(t);return e.length<t?(e.copy(r,t-e.length),r):e.slice(-t)}function d(e,t,r){if(!1===t)return i.from(new n(e).plus(27).toString(16),\"hex\");const s=g(r);return w(new n(s.toString(\"hex\"),16).times(2).plus(35).plus(e).toString(16))}t.buildEthereumMsgRequest=function(e){if(!e.payload||!e.protocol||!e.signerPath)throw new Error(\"You must provide `payload`, `signerPath`, and `protocol` arguments in the messsage request\");const t={schema:s.signingSchema.ETH_MSG,payload:null,input:e,msg:null};if(\"signPersonal\"===e.protocol){const n=4*(e.signerPath.length+1)+e.ethMaxMsgSz+4;let o=0;t.payload=i.alloc(n),t.payload.writeUInt8(s.ethMsgProtocol.SIGN_PERSONAL,0),o+=1,t.payload.writeUInt32LE(e.signerPath.length,o),o+=4;for(let r=0;r<e.signerPath.length;r++)t.payload.writeUInt32LE(e.signerPath[r],o),o+=4;let a=e.payload,c=!1;if(\"string\"===typeof e.payload)if(\"0x\"===e.payload.slice(0,2))a=w(e.payload),c=!0===(r=e.payload.slice(2),/^[0-9a-fA-F]+$/.test(r));else{if(!1===function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)<32||e.charCodeAt(t)>127)return!1;return!0}(e.payload))throw new Error(\"Currently, the Lattice can only display ASCII strings.\");a=i.from(e.payload)}else\"boolean\"===typeof e.displayHex&&(c=e.displayHex);if(t.msg=a,t.payload.writeUInt8(c,o),o+=1,t.payload.writeUInt16LE(a.length,o),o+=2,a.length>e.ethMaxMsgSz)throw new Error(`Your message is ${a.length} bytes, but can only be a maximum of ${e.ethMaxMsgSz}`);return a.copy(t.payload,o),t}throw new Error(\"Unsupported protocol\");var r},t.validateEthereumMsgResponse=function(e,t){const{signer:r,sig:n}=e,{input:s,msg:o}=t;if(\"signPersonal\"===s.protocol){const e=i.from(`\\x19Ethereum Signed Message:\\n${o.length.toString()}`,\"utf-8\");return l(i.concat([e,o]),n,r)}throw new Error(\"Unsupported protocol\")},t.buildEthereumTxRequest=function(e){try{let{chainId:t=1}=e;const{signerPath:r,eip155:n=null,ethMaxDataSz:o}=e;if(\"number\"!==typeof t&&!1===y(t)&&(t=p[t]),!t)throw new Error(\"Unsupported chain ID or name\");if(!r||5!==r.length)throw new Error(\"Please provider full signer path (`signerPath`)\");let a=function(e){switch(e){case 3:case 4:return!1;case 1:case 42:case 5:default:return!0}}(t);null!==n&&\"boolean\"===typeof n&&(a=n),e.value||(e.value=0);const c=[],u=w(e.nonce),l=w(e.gasPrice),h=w(e.gasLimit),f=w(e.to),d=w(e.value),E=w(e.data);c.push(u),c.push(l),c.push(h),c.push(f),c.push(d),c.push(E),!0===a&&(c.push(w(t)),c.push(w(null)),c.push(w(null)));const _=122,v=i.alloc(o+_);let m,b=0;v.writeUInt8(Number(a),b),b++;let S=0;if(!0===function(e){const t=g(e);return 1!==t.length||255===t.readUInt8(0)}(t)){if(m=g(t),S=m.length,S>s.MAX_CHAIN_ID_BYTES)throw new Error(\"ChainID provided is too large.\");v.writeUInt8(s.HANDLE_LARGER_CHAIN_ID,b),b++}else{if(m=w(t),1!==m.length)throw new Error(\"Error parsing chainID\");m.copy(v,b),b+=m.length}v.writeUInt32LE(r.length,b),b+=4;for(let e=0;e<r.length;e++)v.writeUInt32LE(r[e],b),b+=4;v.writeUInt32BE(e.nonce,b),b+=4,function(e,t,r){\"number\"===typeof e&&(e=e.toString(16));const n=i.alloc(8),s=e.length%2===0?e.toString(16):`0${e.toString(16)}`,o=i.from(s,\"hex\");o.copy(n,n.length-o.length),n.copy(t,r)}(e.gasPrice,v,b),b+=8,v.writeUInt32BE(e.gasLimit,b),b+=4,f.copy(v,b),b+=20;const A=b+32-d.length;if(d.copy(v,A),b+=32,E&&E.length>o)return{err:`Data field too large (must be <=${o} bytes)`};if(v.writeUInt16BE(E.length,b),b+=2,E.length+S>o)throw new Error(\"Payload too large.\");return S>0&&(v.writeUInt8(S,b),b++,m.copy(v,b),b+=S),E.copy(v,b),b+=o,{rawTx:c,payload:v,schema:s.signingSchema.ETH_TRANSFER,chainId:t,useEIP155:a,signerPath:r}}catch(t){return{err:t.message}}},t.buildEthRawTx=function(e,t,r,n=!0){const i=l(a.encode(e.rawTx),t,r,e.chainId,n),s=e.rawTx.slice(0,6);return s.push(i.v),s.push(u(i.r)),s.push(u(i.s)),a.encode(s).toString(\"hex\")},t.addRecoveryParam=l,t.hashTransaction=function(e){return o(i.from(e,\"hex\"))};const p={mainnet:1,roptsten:3,rinkeby:4,kovan:42,goerli:5};function g(e){let t,r;if(t=!0===y(e)?w(e):w(new n(e).toString(16)),t.length>8)throw new Error(\"ChainID provided is too large.\");return t.length<=2||4===t.length||8===t.length?t:(3===t.length?(r=i.alloc(4),r.writeUInt32BE(e)):t.length<=8&&(r=i.alloc(8),t.copy(r,8-t.length)),r)}function y(e){return!1===new n(e,16).isNaN()}function w(e){return null===e||0===e?i.alloc(0):(i.isBuffer(e)&&(e=e.toString(\"hex\")),\"number\"===typeof e?e=`${e.toString(16)}`:\"string\"===typeof e&&\"0x\"===e.slice(0,2)&&(e=e.slice(2)),e.length%2>0&&(e=`0${e}`),i.from(e,\"hex\"))}t.chainIds=p,t.ensureHexBuffer=w}}]);","extractedComments":[]}